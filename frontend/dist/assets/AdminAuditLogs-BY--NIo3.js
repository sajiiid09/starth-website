import{R as t,j as e,I as N,Q as T,W as y,X as A,Y as b,Z as g,B as S,c7 as I,g as O,bY as E}from"./index-KrjukJeb.js";import{f as V}from"./MagnifyingGlass.es-Dx2DBm8Z.js";import{C as z,c as F}from"./card-tLMu1Ov7.js";import{T as M,a as P,b as f,c as i,d as Y,e as l}from"./table-CgrnP4CQ.js";import{u as H}from"./useAdminQuery-gkE_Vin9.js";import{a as Q}from"./adminService-C8aRWX_T.js";const _=["VENDOR","BOOKING","PAYMENT","PAYOUT","DISPUTE"],$=r=>new Date(r).toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),q=()=>e.jsx("div",{className:"space-y-3",children:Array.from({length:8}).map((r,j)=>e.jsx("div",{className:"grid grid-cols-5 gap-3",children:Array.from({length:5}).map((n,p)=>e.jsx(E,{className:"h-8 w-full"},p))},j))}),Z=()=>{const[r,j]=t.useState(""),[n,p]=t.useState("ALL"),[o,L]=t.useState("ALL"),[d,C]=t.useState(""),[m,w]=t.useState(""),[D,R]=t.useState({}),{data:x,isLoading:h,error:u,refetch:k}=H(()=>Q.listAuditLogs({q:r||void 0,action:n==="ALL"?void 0:n,resourceType:o==="ALL"?void 0:o}),[r,n,o]),B=t.useMemo(()=>{const s=new Set((x??[]).map(a=>a.action));return Array.from(s).sort()},[x]),v=t.useMemo(()=>(x??[]).filter(s=>{const a=new Date(s.timestamp).getTime();if(d){const c=new Date(`${d}T00:00:00`).getTime();if(a<c)return!1}if(m){const c=new Date(`${m}T23:59:59`).getTime();if(a>c)return!1}return!0}),[x,d,m]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-brand-teal",children:"Control Plane"}),e.jsx("h1",{className:"mt-3 text-3xl font-semibold text-gray-900",children:"Audit logs"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Track admin actions and inspect metadata per event."})]}),e.jsx(z,{className:"border-none shadow-soft",children:e.jsxs(F,{className:"space-y-4 p-6",children:[e.jsxs("div",{className:"grid gap-3 lg:grid-cols-5",children:[e.jsxs("div",{className:"relative lg:col-span-2",children:[e.jsx(V,{className:"pointer-events-none absolute left-3 top-1/2 size-4 -translate-y-1/2 text-gray-400"}),e.jsx(N,{placeholder:"Search logs",className:"pl-9",value:r,onChange:s=>j(s.target.value)})]}),e.jsxs(T,{value:n,onValueChange:p,children:[e.jsx(y,{children:e.jsx(A,{placeholder:"Action"})}),e.jsxs(b,{children:[e.jsx(g,{value:"ALL",children:"All actions"}),B.map(s=>e.jsx(g,{value:s,children:s},s))]})]}),e.jsxs(T,{value:o,onValueChange:L,children:[e.jsx(y,{children:e.jsx(A,{placeholder:"Resource"})}),e.jsxs(b,{children:[e.jsx(g,{value:"ALL",children:"All resources"}),_.map(s=>e.jsx(g,{value:s,children:s},s))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 lg:grid-cols-2",children:[e.jsx(N,{type:"date",value:d,onChange:s=>C(s.target.value)}),e.jsx(N,{type:"date",value:m,onChange:s=>w(s.target.value)})]})]}),h&&e.jsx(q,{}),!h&&u&&e.jsxs("div",{className:"rounded-xl border border-red-100 bg-red-50 p-4 text-sm text-red-700",children:["Failed to load audit logs. ",u.message,e.jsx(S,{variant:"outline",className:"mt-3",onClick:()=>void k(),children:"Retry"})]}),!h&&!u&&v.length===0&&e.jsx("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-8 text-center text-sm text-gray-600",children:"No audit logs match your filters."}),!h&&!u&&v.length>0&&e.jsxs(M,{children:[e.jsx(P,{children:e.jsxs(f,{children:[e.jsx(i,{children:"Time"}),e.jsx(i,{children:"Actor"}),e.jsx(i,{children:"Action"}),e.jsx(i,{children:"Resource"}),e.jsx(i,{className:"text-right",children:"Metadata"})]})}),e.jsx(Y,{children:v.map(s=>{const a=!!D[s.id];return e.jsxs(t.Fragment,{children:[e.jsxs(f,{children:[e.jsx(l,{children:$(s.timestamp)}),e.jsx(l,{children:s.actor}),e.jsx(l,{className:"font-medium",children:s.action}),e.jsxs(l,{children:[s.resourceType," Â· ",s.resourceId]}),e.jsx(l,{className:"text-right",children:e.jsxs(S,{variant:"ghost",size:"sm",onClick:()=>R(c=>({...c,[s.id]:!a})),children:[a?e.jsx(I,{className:"size-4"}):e.jsx(O,{className:"size-4"}),a?"Hide":"View"]})})]}),a&&e.jsx(f,{children:e.jsx(l,{colSpan:5,className:"bg-gray-50",children:e.jsx("pre",{className:"whitespace-pre-wrap text-xs text-gray-700",children:JSON.stringify(s.metadata??{},null,2)})})})]},s.id)})})]})]})})]})};export{Z as default};
