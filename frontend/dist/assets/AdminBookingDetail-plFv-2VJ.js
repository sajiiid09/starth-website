import{bC as C,j as e,bY as g,B as u,L as w,$ as R,a as l}from"./index-KrjukJeb.js";import{C as o,a as m,b,c as h}from"./card-tLMu1Ov7.js";import{T as D,a as A,b as p,c as n,d as k,e as i}from"./table-CgrnP4CQ.js";import{u as T}from"./useAdminQuery-gkE_Vin9.js";import{a as y}from"./adminService-C8aRWX_T.js";const L={CREATED:"bg-slate-100 text-slate-700 border-slate-200",VENDOR_APPROVED:"bg-blue-100 text-blue-700 border-blue-200",COUNTERED:"bg-violet-100 text-violet-700 border-violet-200",READY_FOR_PAYMENT:"bg-amber-100 text-amber-700 border-amber-200",ACTIVE:"bg-cyan-100 text-cyan-700 border-cyan-200",COMPLETED:"bg-emerald-100 text-emerald-700 border-emerald-200",CANCELED:"bg-red-100 text-red-700 border-red-200"},P={REQUESTED:"bg-amber-100 text-amber-700 border-amber-200",PENDING_ADMIN_APPROVAL:"bg-amber-100 text-amber-700 border-amber-200",HELD:"bg-orange-100 text-orange-700 border-orange-200",APPROVED:"bg-blue-100 text-blue-700 border-blue-200",PAID:"bg-emerald-100 text-emerald-700 border-emerald-200",REVERSED:"bg-red-100 text-red-700 border-red-200"},d=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(a/100),c=a=>new Date(a).toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),j=a=>a.replace(/_/g," ").toLowerCase(),B=({category:a})=>a==="HELD"?e.jsx(l,{variant:"outline",className:"bg-amber-100 text-amber-700",children:"Held"}):a==="RELEASED"?e.jsx(l,{variant:"outline",className:"bg-emerald-100 text-emerald-700",children:"Released"}):a==="REVERSAL"?e.jsx(l,{variant:"outline",className:"bg-red-100 text-red-700",children:"Reversal"}):e.jsx(l,{variant:"outline",className:"bg-slate-100 text-slate-700",children:"Payment"}),V=()=>{const{bookingId:a}=C(),{data:N,isLoading:f,error:x,refetch:v}=T(async()=>{if(!a)throw new Error("Missing booking ID");const[s,E]=await Promise.all([y.getBooking(a),y.getBookingFinanceSummary(a)]);return{booking:s,finance:E}},[a],{enabled:!!a});if(f)return e.jsxs("div",{className:"space-y-6",children:[e.jsx(g,{className:"h-10 w-72"}),e.jsx(g,{className:"h-44 w-full"}),e.jsx(g,{className:"h-80 w-full"})]});if(x||!N)return e.jsxs("div",{className:"rounded-xl border border-red-100 bg-red-50 p-5 text-red-700",children:[e.jsxs("p",{children:["Unable to load booking details. ",x==null?void 0:x.message]}),e.jsx(u,{variant:"outline",className:"mt-3",onClick:()=>void v(),children:"Retry"})]});const{booking:t,finance:r}=N;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(u,{asChild:!0,variant:"ghost",className:"-ml-3 mb-2 w-fit",children:e.jsxs(w,{to:"/admin/bookings",children:[e.jsx(R,{className:"size-4"}),"Back to bookings"]})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:t.id}),e.jsx(l,{variant:"outline",className:L[t.state],children:j(t.state)})]}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:[t.eventName," · ",t.organizerName," with ",t.vendorName]})]}),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-[2fr_1fr]",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o,{className:"border-none shadow-soft",children:[e.jsx(m,{children:e.jsx(b,{className:"text-lg",children:"Timeline & milestones"})}),e.jsx(h,{className:"space-y-3",children:t.milestones.map(s=>e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-white p-3",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:s.label}),e.jsx("p",{className:"text-xs text-gray-600",children:s.description}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:c(s.timestamp)})]},s.id))})]}),e.jsxs(o,{className:"border-none shadow-soft",children:[e.jsx(m,{children:e.jsx(b,{className:"text-lg",children:"Payment and payout schedule"})}),e.jsxs(h,{className:"space-y-5",children:[e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Payment status"}),r.payment?e.jsxs("div",{className:"mt-2 text-sm text-gray-700",children:[e.jsxs("p",{children:[r.payment.id," · ",j(r.payment.status)," · ",d(r.payment.amountCents)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Provider ref: ",r.payment.providerRef," · Updated ",c(r.payment.updatedAt)]})]}):e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"No payment captured yet."})]}),e.jsxs(D,{children:[e.jsx(A,{children:e.jsxs(p,{children:[e.jsx(n,{children:"Payout ID"}),e.jsx(n,{children:"Type"}),e.jsx(n,{children:"Amount"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Requested"})]})}),e.jsx(k,{children:r.payouts.map(s=>e.jsxs(p,{children:[e.jsx(i,{children:s.id}),e.jsx(i,{children:s.type.toLowerCase()}),e.jsx(i,{children:d(s.amountCents)}),e.jsx(i,{children:e.jsx(l,{variant:"outline",className:P[s.status],children:j(s.status)})}),e.jsx(i,{children:c(s.requestedAt)})]},s.id))})]})]})]}),t.state==="CANCELED"&&e.jsxs(o,{className:"border-red-200 bg-red-50",children:[e.jsx(m,{children:e.jsx(b,{className:"text-lg text-red-800",children:"Cancellation details"})}),e.jsxs(h,{className:"text-sm text-red-700",children:[e.jsx("p",{children:t.cancellationReason??"No reason provided."}),t.canceledAt&&e.jsxs("p",{className:"mt-2",children:["Canceled at ",c(t.canceledAt)]})]})]})]}),e.jsxs(o,{className:"border-none shadow-soft",children:[e.jsx(m,{children:e.jsx(b,{className:"text-lg",children:"Finance summary"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-xl border border-amber-200 bg-amber-50 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-amber-700",children:"Held"}),e.jsx("p",{className:"text-xl font-semibold text-amber-800",children:d(r.heldFundsCents)})]}),e.jsxs("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-emerald-700",children:"Released"}),e.jsx("p",{className:"text-xl font-semibold text-emerald-800",children:d(r.releasedFundsCents)})]}),e.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-red-700",children:"Reversed"}),e.jsx("p",{className:"text-xl font-semibold text-red-800",children:d(r.reversedFundsCents)})]}),e.jsxs("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-3",children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-600",children:"Booking total"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:d(r.bookingTotalCents)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Ledger"}),e.jsx("div",{className:"mt-2 space-y-2",children:r.ledger.length===0?e.jsx("p",{className:"text-xs text-gray-500",children:"No ledger entries yet."}):r.ledger.map(s=>e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-white p-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("p",{className:"text-xs font-medium text-gray-800",children:s.label}),e.jsx(B,{category:s.category})]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-600",children:[d(s.amountCents)," · ",c(s.occurredAt)]})]},s.id))})]})]})]})]})]})};export{V as default};
