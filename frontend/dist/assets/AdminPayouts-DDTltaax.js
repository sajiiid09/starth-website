import{R as r,j as e,I as K,B as c,a as W,bX as t,ak as Z,al as $,am as ee,an as se,bL as ae,T as L,bM as re,bY as te,t as u}from"./index-KrjukJeb.js";import{f as ne}from"./MagnifyingGlass.es-Dx2DBm8Z.js";import{c as le}from"./Warning.es-BeHDD-et.js";import{C as oe,c as ie}from"./card-tLMu1Ov7.js";import{T as de,a as ce,b as ue}from"./tabs-BVUoMm7C.js";import{u as C,A as O,a as k,b as H,c as F,d as M,e as V,f as _,g as q}from"./useAdminMutation-jiVJ-Wgr.js";import{T as xe,a as me,b as B,c as l,d as he,e as o}from"./table-CgrnP4CQ.js";import{u as pe}from"./useAdminQuery-gkE_Vin9.js";import{a as v}from"./adminService-C8aRWX_T.js";const ge=[{label:"Pending admin approval",value:"PENDING"},{label:"Held",value:"HELD"},{label:"Approved / paid",value:"APPROVED_PAID"}],je={REQUESTED:"bg-amber-100 text-amber-700 border-amber-200",PENDING_ADMIN_APPROVAL:"bg-amber-100 text-amber-700 border-amber-200",HELD:"bg-orange-100 text-orange-700 border-orange-200",APPROVED:"bg-blue-100 text-blue-700 border-blue-200",PAID:"bg-emerald-100 text-emerald-700 border-emerald-200",REVERSED:"bg-red-100 text-red-700 border-red-200"},ve=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(a/100),be=a=>new Date(a).toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),fe=a=>a.replace(/_/g," ").toLowerCase(),z=a=>a==="REQUESTED"||a==="PENDING_ADMIN_APPROVAL",ye=(a,n)=>a==="PENDING"?z(n):a==="HELD"?n==="HELD":n==="APPROVED"||n==="PAID",Ne=()=>e.jsx("div",{className:"space-y-3",children:Array.from({length:6}).map((a,n)=>e.jsx("div",{className:"grid grid-cols-7 gap-3",children:Array.from({length:7}).map((m,b)=>e.jsx(te,{className:"h-8 w-full"},b))},n))}),Ie=()=>{const[a,n]=r.useState("PENDING"),[m,b]=r.useState(""),[i,d]=r.useState(null),[G,h]=r.useState(!1),[Q,f]=r.useState(!1),[P,E]=r.useState(""),[R,T]=r.useState(""),[U,y]=r.useState(!1),{data:w,isLoading:p,error:g,refetch:j}=pe(()=>v.listPayouts({q:m||void 0}),[m]),S=C(s=>v.approvePayout(s,{confirm:!0})),N=C(({payoutId:s,reason:x})=>v.holdPayout(s,x)),I=C(({payoutId:s,reason:x})=>v.reversePayout(s,x)),D=r.useMemo(()=>(w??[]).filter(x=>ye(a,x.status)),[w,a]),A=S.isLoading||N.isLoading||I.isLoading,X=async()=>{if(i&&!t)try{await S.mutate(i.id),u.success("Payout approved"),y(!1),d(null),await j()}catch(s){u.error(s instanceof Error?s.message:"Failed to approve payout")}},Y=async()=>{if(i&&!t)try{await N.mutate({payoutId:i.id,reason:P.trim()||void 0}),u.success("Payout moved to held state"),h(!1),E(""),d(null),await j()}catch(s){u.error(s instanceof Error?s.message:"Failed to hold payout")}},J=async()=>{if(i&&!t)try{await I.mutate({payoutId:i.id,reason:R.trim()||void 0}),u.success("Payout reversed"),f(!1),T(""),d(null),await j()}catch(s){u.error(s instanceof Error?s.message:"Failed to reverse payout")}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-brand-teal",children:"Finance"}),e.jsx("h1",{className:"mt-3 text-3xl font-semibold text-gray-900",children:"Payout queue"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Controlled payouts: hold funds until approved, then release reservation or final payout."})]}),e.jsx(oe,{className:"border-none shadow-soft",children:e.jsxs(ie,{className:"space-y-4 p-6",children:[e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:[e.jsx(de,{value:a,onValueChange:s=>n(s),children:e.jsx(ce,{className:"flex h-auto flex-wrap gap-1 bg-gray-100 p-1",children:ge.map(s=>e.jsx(ue,{value:s.value,className:"text-xs sm:text-sm",children:s.label},s.value))})}),e.jsxs("div",{className:"relative w-full lg:w-80",children:[e.jsx(ne,{className:"pointer-events-none absolute left-3 top-1/2 size-4 -translate-y-1/2 text-gray-400"}),e.jsx(K,{value:m,onChange:s=>b(s.target.value),placeholder:"Search by payout, vendor, booking",className:"pl-9"})]})]}),p&&e.jsx(Ne,{}),!p&&g&&e.jsxs("div",{className:"rounded-xl border border-red-100 bg-red-50 p-4 text-sm text-red-700",children:["Failed to load payout queue. ",g.message,e.jsx(c,{variant:"outline",className:"mt-3",onClick:()=>void j(),children:"Retry"})]}),!p&&!g&&D.length===0&&e.jsx("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-8 text-center text-sm text-gray-600",children:"No payouts in this queue."}),!p&&!g&&D.length>0&&e.jsxs(xe,{children:[e.jsx(me,{children:e.jsxs(B,{children:[e.jsx(l,{children:"Payout ID"}),e.jsx(l,{children:"Vendor"}),e.jsx(l,{children:"Booking ID"}),e.jsx(l,{children:"Type"}),e.jsx(l,{children:"Amount"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Requested"}),e.jsx(l,{className:"text-right",children:"Actions"})]})}),e.jsx(he,{children:D.map(s=>e.jsxs(B,{children:[e.jsx(o,{className:"font-medium",children:s.id}),e.jsx(o,{children:s.vendorName}),e.jsx(o,{children:s.bookingId}),e.jsx(o,{children:s.type.toLowerCase()}),e.jsx(o,{children:ve(s.amountCents)}),e.jsx(o,{children:e.jsx(W,{variant:"outline",className:je[s.status],children:fe(s.status)})}),e.jsx(o,{children:be(s.requestedAt)}),e.jsx(o,{className:"text-right",children:z(s.status)?e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(c,{size:"sm",onClick:()=>{d(s),y(!0)},disabled:A||t,children:"Approve"}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>{d(s),h(!0)},disabled:A||t,children:"Hold"}),e.jsx(c,{size:"sm",variant:"destructive",onClick:()=>{d(s),f(!0)},disabled:A||t,children:"Reverse"})]}):e.jsx("span",{className:"text-xs text-gray-500",children:"No actions"})})]},s.id))})]})]})}),e.jsx(O,{open:U,onOpenChange:y,children:e.jsxs(k,{children:[e.jsxs(H,{children:[e.jsx(F,{children:"Approve payout release?"}),e.jsx(M,{children:"This will move funds from held to released for the vendor."})]}),e.jsxs(V,{children:[e.jsx(_,{children:"Cancel"}),e.jsx(q,{onClick:()=>void X(),disabled:t,children:"Approve payout"})]})]})}),e.jsx(Z,{open:G,onOpenChange:h,children:e.jsxs($,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"Hold payout"}),e.jsx(ae,{children:"Add an optional reason for audit history and risk review."})]}),e.jsx(L,{value:P,onChange:s=>E(s.target.value),placeholder:"Optional reason",rows:4}),e.jsxs(re,{children:[e.jsx(c,{variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsx(c,{onClick:()=>void Y(),disabled:N.isLoading||t,children:"Hold payout"})]})]})}),e.jsx(O,{open:Q,onOpenChange:f,children:e.jsxs(k,{children:[e.jsxs(H,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"size-4 text-red-600"}),"Reverse payout?"]}),e.jsx(M,{children:"Reversal is a dangerous action. Add context for why funds should not be released."})]}),e.jsx(L,{value:R,onChange:s=>T(s.target.value),placeholder:"Optional reversal reason",rows:4}),e.jsxs(V,{children:[e.jsx(_,{children:"Cancel"}),e.jsx(q,{onClick:()=>void J(),disabled:t,children:"Reverse payout"})]})]})})]})};export{Ie as default};
