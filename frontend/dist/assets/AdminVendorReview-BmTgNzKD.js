import{bC as G,q as Y,R as i,j as e,B as n,L,$ as z,a as W,bX as r,ak as Q,al as X,am as $,an as J,bL as K,T as O,bM as Z,bY as x,t as o}from"./index-KrjukJeb.js";import{c as ee}from"./Warning.es-BeHDD-et.js";import{C as u,a as h,b as g,c as p}from"./card-tLMu1Ov7.js";import{u as v,A as se,a as ae,b as te,c as ne,d as re,e as ie,f as oe,g as le}from"./useAdminMutation-jiVJ-Wgr.js";import{u as ce}from"./useAdminQuery-gkE_Vin9.js";import{a as b}from"./adminService-C8aRWX_T.js";const de=t=>t==="NEEDS_CHANGES"?"Needs changes":t==="DISABLED_PAYOUT"?"Disabled payout":t.charAt(0)+t.slice(1).toLowerCase(),me={PENDING:"bg-amber-100 text-amber-700 border-amber-200",APPROVED:"bg-emerald-100 text-emerald-700 border-emerald-200",NEEDS_CHANGES:"bg-orange-100 text-orange-700 border-orange-200",DISABLED_PAYOUT:"bg-red-100 text-red-700 border-red-200"},xe=t=>t==="VENUE_OWNER"?"Venue Owner":"Service Provider",V=t=>new Date(t).toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}),ue=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx(x,{className:"h-9 w-64"}),e.jsx(x,{className:"h-40 w-full"}),e.jsx(x,{className:"h-56 w-full"}),e.jsx(x,{className:"h-40 w-full"})]}),ye=()=>{const{vendorId:t}=G(),P=Y(),[s,l]=i.useState(null),[R,d]=i.useState(!1),[B,j]=i.useState(!1),[D,C]=i.useState(""),[S,T]=i.useState(""),{data:m,isLoading:U,error:A,refetch:M}=ce(()=>b.getVendor(t??""),[t],{enabled:!!t});i.useEffect(()=>{m&&(l(m),C(m.submission.note??""))},[m]);const N=i.useCallback((a,c,H)=>{if(!s)return;const F=s,k=new Date().toISOString();return l({...s,verificationState:a,payoutEnabled:c,updatedAt:k,submission:{...s.submission,lastUpdatedAt:k,note:H??s.submission.note}}),{rollback:()=>l(F)}},[s]),E=v(a=>b.approveVendor(a),{onMutate:()=>N("APPROVED",!0),onSuccess:a=>{l(a),o.success("Vendor approved")},onError:a=>{o.error(a.message||"Unable to approve vendor")}}),y=v(({id:a,note:c})=>b.needsChangesVendor(a,c),{onMutate:a=>N("NEEDS_CHANGES",!1,a.note),onSuccess:a=>{l(a),d(!1),o.success("Marked as needs changes")},onError:a=>{o.error(a.message||"Unable to update vendor")}}),w=v(({id:a,reason:c})=>b.disableVendorPayout(a,c),{onMutate:a=>N("DISABLED_PAYOUT",!1,a.reason),onSuccess:a=>{l(a),j(!1),o.success("Payout eligibility disabled")},onError:a=>{o.error(a.message||"Unable to disable payouts")}}),f=E.isLoading||y.isLoading||w.isLoading,I=async()=>{if(t&&!r)try{await E.mutate(t)}catch{}},_=async()=>{if(!t||r)return;const a=D.trim();if(!a){o.error("Add a note for requested changes");return}try{await y.mutate({id:t,note:a})}catch{}},q=async()=>{if(t&&!r)try{await w.mutate({id:t,reason:S.trim()||void 0})}catch{}};return t?U&&!s?e.jsx(ue,{}):A&&!s?e.jsxs("div",{className:"space-y-4 rounded-xl border border-red-100 bg-red-50 p-6 text-red-700",children:[e.jsxs("p",{children:["Unable to load vendor review. ",A.message]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>void M(),children:"Try again"}),e.jsx(n,{variant:"ghost",onClick:()=>P("/admin/vendors"),children:"Back to vendors"})]})]}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx(n,{asChild:!0,variant:"ghost",className:"mb-2 -ml-3 w-fit",children:e.jsxs(L,{to:"/admin/vendors",children:[e.jsx(z,{className:"size-4"}),"Back to queue"]})}),e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:s.displayName}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"Review submission and verification controls"})]}),e.jsx(W,{variant:"outline",className:me[s.verificationState],children:de(s.verificationState)})]}),e.jsxs(u,{className:"border-none shadow-soft",children:[e.jsx(h,{children:e.jsx(g,{className:"text-lg",children:"Basic info"})}),e.jsxs(p,{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Subtype:"})," ",xe(s.subtype)]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Contact:"})," ",s.contactName]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Email:"})," ",s.contactEmail]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Phone:"})," ",s.contactPhone]}),e.jsxs("p",{className:"text-sm text-gray-700 sm:col-span-2",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Location:"})," ",s.city,", ",s.state]})]})]}),e.jsxs(u,{className:"border-none shadow-soft",children:[e.jsx(h,{children:e.jsx(g,{className:"text-lg",children:"Subtype details"})}),e.jsxs(p,{className:"space-y-3",children:[s.subtype==="VENUE_OWNER"&&s.venueDetails&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Square feet:"})," ",s.venueDetails.squareFeet.toLocaleString()]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Venue type:"})," ",s.venueDetails.venueType]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Address:"})," ",s.venueDetails.address]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Capacity notes:"})," ",s.venueDetails.capacityNotes]})]}),s.subtype==="SERVICE_PROVIDER"&&s.serviceDetails&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Categories:"})," ",s.serviceDetails.categories.join(", ")]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Service areas:"})," ",s.serviceDetails.serviceAreas.join(", ")]})]})]})]}),e.jsxs(u,{className:"border-none shadow-soft",children:[e.jsx(h,{children:e.jsx(g,{className:"text-lg",children:"Verification submission"})}),e.jsxs(p,{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Submitted:"})," ",V(s.submission.submittedAt)]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Submitted by:"})," ",s.submission.submittedBy]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Documents:"})," ",s.submission.documents.join(", ")]}),e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Last updated:"})," ",V(s.submission.lastUpdatedAt)]}),s.submission.note&&e.jsxs("p",{className:"rounded-lg border border-gray-200 bg-gray-50 p-3 text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:"Last reviewer note:"})," ",s.submission.note]})]})]}),e.jsxs(u,{className:"border-none shadow-soft",children:[e.jsx(h,{children:e.jsx(g,{className:"text-lg",children:"Review actions"})}),e.jsxs(p,{className:"flex flex-wrap gap-3",children:[e.jsx(n,{onClick:()=>void I(),disabled:f||r,children:"Approve"}),e.jsx(n,{variant:"outline",onClick:()=>d(!0),disabled:f||r,children:"Needs changes"}),e.jsx(n,{variant:"destructive",onClick:()=>j(!0),disabled:f||r,children:"Disable payout"})]})]}),e.jsx(Q,{open:R,onOpenChange:d,children:e.jsxs(X,{children:[e.jsxs($,{children:[e.jsx(J,{children:"Request changes"}),e.jsx(K,{children:"Add clear feedback so the vendor can update their verification submission."})]}),e.jsx(O,{value:D,onChange:a=>C(a.target.value),placeholder:"Example: Please upload a valid insurance certificate through Dec 2026.",rows:5}),e.jsxs(Z,{children:[e.jsx(n,{variant:"outline",onClick:()=>d(!1),children:"Cancel"}),e.jsx(n,{onClick:()=>void _(),disabled:y.isLoading||r,children:"Submit note"})]})]})}),e.jsx(se,{open:B,onOpenChange:j,children:e.jsxs(ae,{children:[e.jsxs(te,{children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"size-4 text-red-600"}),"Disable payout eligibility?"]}),e.jsx(re,{children:"This is an emergency control. The vendor can keep operating but payouts stay blocked."})]}),e.jsx(O,{value:S,onChange:a=>T(a.target.value),placeholder:"Optional reason for audit history",rows:4}),e.jsxs(ie,{children:[e.jsx(oe,{children:"Cancel"}),e.jsx(le,{onClick:()=>void q(),disabled:r,children:"Disable payout"})]})]})})]}):e.jsxs("div",{className:"space-y-4 rounded-xl border border-gray-200 bg-white p-6",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vendor not found."}),e.jsx(n,{asChild:!0,variant:"outline",children:e.jsx(L,{to:"/admin/vendors",children:"Back to vendors"})})]}):e.jsx("div",{className:"rounded-xl border border-red-100 bg-red-50 p-6 text-sm text-red-700",children:"Missing vendor ID."})};export{ye as default};
