import{q as xe,r as u,U as he,G as ue,t as _,j as e,B as o,$ as ge,s as je,I as i,T as be,N as z,d as M,n as q,a as H,L as J,e as E,a4 as ve,aj as pe,a3 as Ne,ah as _e}from"./index-KrjukJeb.js";import{C as g,a as f,b as y,c as j}from"./card-tLMu1Ov7.js";import{C as $}from"./checkbox-uGjIcrta.js";import{P as K,a as Q,b as W,C as X}from"./popover-BG0fWMNa.js";import{T as fe,a as ye,b as w,c as C}from"./tabs-BVUoMm7C.js";import{n as Y}from"./Clock.es-CCh8QZyI.js";import{m as Z}from"./CurrencyDollar.es-CPzZPXmX.js";import{m as we}from"./FloppyDisk.es-BgK92nk8.js";import{f as ee}from"./isSameMonth-Ccyd4klX.js";import"./en-US-B77o_Iq_.js";import"./differenceInCalendarMonths-DCHHw2al.js";function De(){var F,G;const S=xe(),[se,te]=u.useState(!0),[I,T]=u.useState(!1),[ae,le]=u.useState(null),[b,ne]=u.useState(null),[t,m]=u.useState({title:"",description:"",event_type:"",date_start:null,date_end:null,start_time:"09:00",end_time:"17:00",city:"",guest_count:"",budget_target:"",eventbrite_enabled:!1,selected_venues:[],selected_vendors:[],guest_list:[]}),[v,P]=u.useState({name:"",email:""});u.useEffect(()=>{re()},[]);const re=async()=>{var s,a;try{const l=await he.me();le(l);const x=new URLSearchParams(window.location.search).get("planId");if(x){const n=await ue.get(x);ne(n);const N=((s=n.recommendations_json)==null?void 0:s.venues)||[],h=((a=n.recommendations_json)==null?void 0:a.vendors)||[];m(d=>{var A,O,U,R;return{...d,title:n.title||"",event_type:((A=n.recommendations_json)==null?void 0:A.event_type)||"",city:((O=n.recommendations_json)==null?void 0:O.location)||"",budget_target:((U=n.budget_json)==null?void 0:U.total)||"",guest_count:((R=n.recommendations_json)==null?void 0:R.estimated_guests)||"",selected_venues:N.filter(k=>k.status==="booked").slice(0,1),selected_vendors:h.filter(k=>k.status==="booked")}})}}catch(l){console.error("Error loading data:",l),_.error("Failed to load event data")}te(!1)},r=(s,a)=>{m(l=>({...l,[s]:a}))},ce=s=>{m(a=>({...a,selected_venues:a.selected_venues.find(l=>l.id===s.id)?a.selected_venues.filter(l=>l.id!==s.id):[...a.selected_venues,s]}))},ie=s=>{m(a=>({...a,selected_vendors:a.selected_vendors.find(l=>l.name===s.name)?a.selected_vendors.filter(l=>l.name!==s.name):[...a.selected_vendors,s]}))},de=()=>{if(!v.name||!v.email){_.error("Please enter both name and email");return}m(s=>({...s,guest_list:[...s.guest_list,{...v,id:Date.now()}]})),P({name:"",email:""})},oe=s=>{m(a=>({...a,guest_list:a.guest_list.filter(l=>l.id!==s)}))},V=()=>{let s=0;return t.selected_venues.forEach(a=>{var l;s+=a.price||((l=a.rate_card_json)==null?void 0:l.base_rate)||0}),t.selected_vendors.forEach(a=>{var l;s+=a.price||((l=a.rate_card_json)==null?void 0:l.base_rate)||0}),s},me=async()=>{var s;if(!t.title||!t.date_start){_.error("Please provide event name and start date");return}T(!0);try{const a=[...t.selected_venues.map(c=>c.name),...t.selected_vendors.map(c=>c.category)],l=await Ne.create({organizer_id:ae.id,title:t.title,event_type:t.event_type||"other",description:t.description,date_start:t.date_start.toISOString(),date_end:((s=t.date_end)==null?void 0:s.toISOString())||t.date_start.toISOString(),city:t.city,guest_count:parseInt(t.guest_count)||null,budget_target:parseFloat(t.budget_target)||V(),selected_categories:a,eventbrite_enabled:t.eventbrite_enabled,status:"planning"});t.eventbrite_enabled&&await _e.create({event_id:l.id,eb_org_id:"ORG123",eb_event_id:`EVT${Date.now()}`,eb_ticket_url:`https://www.eventbrite.com/e/${Date.now()}`,last_synced_at:new Date().toISOString()}),_.success("Event created successfully!"),S(E("EventDetails")+`?id=${l.id}`)}catch(a){console.error("Error creating event:",a),_.error("Failed to create event")}T(!1)};if(se)return e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});const L=((F=b==null?void 0:b.recommendations_json)==null?void 0:F.venues)||[],B=((G=b==null?void 0:b.recommendations_json)==null?void 0:G.vendors)||[],D=V(),p=parseFloat(t.budget_target)-D;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-4 md:p-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>S(-1),children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Event Builder"}),e.jsx("p",{className:"text-gray-600",children:"Finalize your event details and publish"})]})]}),e.jsxs(fe,{defaultValue:"details",className:"space-y-6",children:[e.jsxs(ye,{className:"grid w-full grid-cols-4",children:[e.jsx(w,{value:"details",children:"Event Details"}),e.jsx(w,{value:"venue-vendors",children:"Venue & Vendors"}),e.jsx(w,{value:"guests",children:"Guest List"}),e.jsx(w,{value:"budget",children:"Budget"})]}),e.jsx(C,{value:"details",className:"space-y-6",children:e.jsxs(g,{className:"border-none shadow-lg",children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"w-5 h-5 text-blue-600"}),"Basic Information"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Event Name *"}),e.jsx(i,{placeholder:"e.g., Annual Product Launch 2025",value:t.title,onChange:s=>r("title",s.target.value),className:"text-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx(be,{placeholder:"Describe your event...",value:t.description,onChange:s=>r("description",s.target.value),className:"h-32"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date *"}),e.jsxs(K,{children:[e.jsx(Q,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:"w-full justify-start",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),t.date_start?ee(t.date_start,"PPP"):"Select date"]})}),e.jsx(W,{className:"w-auto p-0",children:e.jsx(X,{mode:"single",selected:t.date_start,onSelect:s=>r("date_start",s)})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),e.jsxs(K,{children:[e.jsx(Q,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:"w-full justify-start",children:[e.jsx(z,{className:"mr-2 h-4 w-4"}),t.date_end?ee(t.date_end,"PPP"):"Select date"]})}),e.jsx(W,{className:"w-auto p-0",children:e.jsx(X,{mode:"single",selected:t.date_end,onSelect:s=>r("date_end",s)})})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(i,{type:"time",value:t.start_time,onChange:s=>r("start_time",s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Time"}),e.jsxs("div",{className:"relative",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(i,{type:"time",value:t.end_time,onChange:s=>r("end_time",s.target.value),className:"pl-10"})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Location"}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(i,{placeholder:"City, State",value:t.city,onChange:s=>r("city",s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Expected Guests"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(i,{type:"number",placeholder:"Number of guests",value:t.guest_count,onChange:s=>r("guest_count",s.target.value),className:"pl-10"})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($,{id:"eventbrite",checked:t.eventbrite_enabled,onCheckedChange:s=>r("eventbrite_enabled",s)}),e.jsx("label",{htmlFor:"eventbrite",className:"text-sm font-medium text-gray-700 cursor-pointer",children:"Enable Eventbrite Ticketing & Registration"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 ml-6",children:"Automatically create an Eventbrite event and manage ticket sales"})]})]})]})}),e.jsxs(C,{value:"venue-vendors",className:"space-y-6",children:[L.length>0?e.jsxs(g,{className:"border-none shadow-lg",children:[e.jsx(f,{children:e.jsx(y,{children:"Select Venue"})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-3",children:L.map((s,a)=>{var x;const l=t.selected_venues.find(n=>n.name===s.name),c=l?t.selected_venues.find(n=>n.name===s.name):s;return e.jsx("div",{className:`p-4 rounded-lg border-2 transition-all ${l?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{checked:!!l,onCheckedChange:()=>ce(s)}),e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 ml-6",children:s.location}),s.capacity&&e.jsxs(H,{variant:"secondary",className:"mt-2 ml-6",children:["Capacity: ",s.capacity]})]}),e.jsx("div",{className:"text-right",children:e.jsx(i,{type:"number",placeholder:"Price",value:c.price||((x=c.rate_card_json)==null?void 0:x.base_rate)||"",onChange:n=>{const N=parseFloat(n.target.value)||0;m(h=>({...h,selected_venues:h.selected_venues.map(d=>d.name===s.name?{...d,price:N}:d)}))},className:"w-32 text-right",onClick:n=>n.stopPropagation()})})]})},a)})})})]}):e.jsx(g,{className:"border-none shadow-lg",children:e.jsxs(j,{className:"p-8 text-center",children:[e.jsx(M,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No venues in this plan"}),e.jsx(J,{to:E("AIPlanner"),children:e.jsx(o,{variant:"outline",children:"Find Venues with AI"})})]})}),B.length>0?e.jsxs(g,{className:"border-none shadow-lg",children:[e.jsx(f,{children:e.jsx(y,{children:"Select Vendors"})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-3",children:B.map((s,a)=>{var x;const l=t.selected_vendors.find(n=>n.name===s.name),c=l?t.selected_vendors.find(n=>n.name===s.name):s;return e.jsx("div",{className:`p-4 rounded-lg border-2 transition-all ${l?"border-blue-600 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{checked:!!l,onCheckedChange:()=>ie(s)}),e.jsx("h3",{className:"font-semibold text-gray-900",children:s.name})]}),e.jsx(H,{className:"mt-2 ml-6",children:s.category})]}),e.jsx("div",{className:"text-right",children:e.jsx(i,{type:"number",placeholder:"Price",value:c.price||((x=c.rate_card_json)==null?void 0:x.base_rate)||"",onChange:n=>{const N=parseFloat(n.target.value)||0;m(h=>({...h,selected_vendors:h.selected_vendors.map(d=>d.name===s.name?{...d,price:N}:d)}))},className:"w-32 text-right",onClick:n=>n.stopPropagation()})})]})},a)})})})]}):e.jsx(g,{className:"border-none shadow-lg",children:e.jsxs(j,{className:"p-8 text-center",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No vendors in this plan"}),e.jsx(J,{to:E("AIPlanner"),children:e.jsx(o,{variant:"outline",children:"Find Vendors with AI"})})]})})]}),e.jsx(C,{value:"guests",className:"space-y-6",children:e.jsxs(g,{className:"border-none shadow-lg",children:[e.jsx(f,{children:e.jsx(y,{children:"Manage Guest List"})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-3",children:[e.jsx(i,{placeholder:"Guest name",value:v.name,onChange:s=>P(a=>({...a,name:s.target.value}))}),e.jsx(i,{type:"email",placeholder:"Guest email",value:v.email,onChange:s=>P(a=>({...a,email:s.target.value}))})]}),e.jsxs(o,{onClick:de,className:"w-full",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Add Guest"]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"font-medium mb-3",children:["Guest List (",t.guest_list.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.guest_list.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email})]}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>oe(s.id),children:e.jsx(pe,{className:"w-4 h-4 text-gray-500"})})]},s.id))})]})]})]})}),e.jsx(C,{value:"budget",className:"space-y-6",children:e.jsxs(g,{className:"border-none shadow-lg",children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-green-600"}),"Budget Overview"]})}),e.jsxs(j,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Budget"}),e.jsxs("div",{className:"relative",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(i,{type:"number",placeholder:"Enter total budget",value:t.budget_target,onChange:s=>r("budget_target",s.target.value),className:"pl-10 text-lg"})]})]}),e.jsxs("div",{className:"border-t pt-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Selected Venues"}),e.jsxs("span",{className:"font-semibold",children:["$",t.selected_venues.reduce((s,a)=>{var l;return s+(a.price||((l=a.rate_card_json)==null?void 0:l.base_rate)||0)},0).toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Selected Vendors"}),e.jsxs("span",{className:"font-semibold",children:["$",t.selected_vendors.reduce((s,a)=>{var l;return s+(a.price||((l=a.rate_card_json)==null?void 0:l.base_rate)||0)},0).toLocaleString()]})]}),e.jsxs("div",{className:"border-t pt-3 flex justify-between",children:[e.jsx("span",{className:"font-semibold text-lg",children:"Total Estimated Cost"}),e.jsxs("span",{className:"font-bold text-xl",children:["$",D.toLocaleString()]})]}),t.budget_target&&e.jsx("div",{className:`p-3 rounded-lg ${p>=0?"bg-green-50":"bg-red-50"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:`font-medium ${p>=0?"text-green-700":"text-red-700"}`,children:p>=0?"Under Budget":"Over Budget"}),e.jsxs("span",{className:`font-bold ${p>=0?"text-green-700":"text-red-700"}`,children:["$",Math.abs(p).toLocaleString()]})]})})]})]})]})})]}),e.jsxs("div",{className:"flex gap-4 mt-8",children:[e.jsx(o,{variant:"outline",className:"flex-1",onClick:()=>S(-1),children:"Cancel"}),e.jsx(o,{onClick:me,disabled:I,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white",children:I?e.jsx(e.Fragment,{children:"Saving..."}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"w-4 h-4 mr-2"}),"Save & Publish Event"]})})]})]})})}export{De as default};
