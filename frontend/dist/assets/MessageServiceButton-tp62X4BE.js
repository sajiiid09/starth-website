import{r as w,j as r,B as h,y as _,U as x,a9 as a,aa as y,ab as P,t as o,e as C}from"./index-KrjukJeb.js";import{s as M}from"./ChatCircle.es-DeE-r4hZ.js";function k({service:i,className:p,children:v}){const[n,c]=w.useState(!1),m=async()=>{var d,l;c(!0);try{const e=await x.me(),f=await a.filter({user_id:e.id});let g=null;for(const t of f)if((await a.filter({conversation_id:t.conversation_id})).some(u=>u.user_id===i.provider_id&&u.user_id!==e.id)){g=t.conversation_id;break}let s=g;s?o.success("Opening existing conversation..."):(s=(await y.create({})).id,await a.create({conversation_id:s,user_id:e.id}),await a.create({conversation_id:s,user_id:i.provider_id}),await P.create({conversation_id:s,sender_id:e.id,text:`Hi! I'm interested in your ${i.category} services for an upcoming event. Could you please provide more details about your offerings and pricing?`}),o.success("Message sent! Redirecting to conversation...")),window.location.href=C("Messages")}catch(e){console.error("Error creating message:",e),(d=e.message)!=null&&d.includes("401")||((l=e.response)==null?void 0:l.status)===401?(localStorage.setItem("postLoginRedirect",window.location.pathname+window.location.search),window.location.href="/api/auth/login"):o.error("Failed to send message. Please try again.")}c(!1)};return r.jsxs(h,{className:p,onClick:m,disabled:n,children:[n?r.jsx(_,{className:"w-4 h-4 animate-spin mr-2"}):r.jsx(M,{className:"w-4 h-4 mr-2"}),v||"Message"]})}export{k as M};
