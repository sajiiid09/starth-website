import{r as l,U as E,ao as R,av as b,t as u,j as e,y,B as x,as as N,a as p,ak as T,al as A,am as G,an as H,Q as V,W as X,X as J,Y as M,Z as Q,I as W,T as Y,aH as Z,_ as K,b as ee}from"./index-KrjukJeb.js";import{C as _,a as D,b as w,c as S}from"./card-tLMu1Ov7.js";import{n as se}from"./Clock.es-CCh8QZyI.js";import{s as te}from"./Upload.es-Dw-8j3Wc.js";import{m as ae}from"./WarningCircle.es-6KbXsyM7.js";import{R as C}from"./RoleGuard-DRkcvV5M.js";import{P as U}from"./ProviderPortalLayout-D3ZJZ5Ow.js";import"./Envelope.es-BErI3QgS.js";import"./Shield.es-C51nR2_i.js";const d=[{value:"identity",label:"Identity Documents",required:!0},{value:"business_license",label:"Business License",required:!0},{value:"insurance_certificate",label:"Insurance Certificate",required:!1},{value:"permits",label:"Permits & Certifications",required:!1}];function pe(){const[q,P]=l.useState(null),[n,$]=l.useState(null),[c,O]=l.useState([]),[F,I]=l.useState(!0),[L,i]=l.useState(!1),[m,g]=l.useState(!1),[a,o]=l.useState({doc_type:"",notes:"",file:null});l.useEffect(()=>{h()},[]);const h=async()=>{try{const s=await E.me();P(s);const t=await R.filter({owner_user_id:s.id,type:"service_provider"});if(t.length>0){$(t[0]);const r=await b.filter({org_id:t[0].id});O(r)}}catch(s){console.error("Error fetching documents data:",s),u.error("Failed to load documents")}I(!1)},k=async s=>{var t;if(s.preventDefault(),!(!n||!a.file)){g(!0);try{const{file_url:r}=await Z({file:a.file}),re=await b.create({org_id:n.id,entity_type:"organization",entity_id:n.id,doc_type:a.doc_type,storage_url:r,uploaded_by:q.id,verified_status:"pending",notes:a.notes}),v=((t=d.find(B=>B.value===a.doc_type))==null?void 0:t.label)||a.doc_type,z=`
        A new document has been uploaded for approval.
        <br><br>
        <strong>Organization:</strong> ${n.name}<br>
        <strong>Document Type:</strong> ${v}<br>
        <strong>File Name:</strong> ${a.file.name}<br>
        <strong>Notes:</strong> ${a.notes||"None"}<br><br>
        Please review and approve in the admin dashboard.
      `;await K({to:"info@renzairegroup.com",subject:`Document Uploaded for Approval: ${n.name} - ${v}`,body:z}),u.success("Document uploaded and submitted for approval"),i(!1),o({doc_type:"",notes:"",file:null}),h()}catch(r){console.error("Error uploading document:",r),u.error("Failed to upload document")}g(!1)}},f=s=>{switch(s){case"verified":return e.jsx(ee,{className:"w-5 h-5 text-green-600"});case"rejected":return e.jsx(ae,{className:"w-5 h-5 text-red-600"});default:return e.jsx(se,{className:"w-5 h-5 text-yellow-600"})}},j=s=>{const t={verified:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",pending:"bg-yellow-100 text-yellow-800"};return t[s]||t.pending};return F?e.jsx(C,{requiredRole:"service_provider",children:e.jsx(U,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(y,{className:"w-8 h-8 animate-spin text-gray-500"})})})}):e.jsx(C,{requiredRole:"service_provider",children:e.jsx(U,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Documents"}),e.jsx("p",{className:"text-gray-600",children:"Upload required verification documents"})]}),e.jsxs(x,{onClick:()=>i(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Upload Document"]})]}),e.jsxs(_,{className:"border-none shadow-lg mb-8",children:[e.jsx(D,{children:e.jsx(w,{children:"Required Documents"})}),e.jsx(S,{children:e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:d.map(s=>{const t=c.find(r=>r.doc_type===s.value);return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-900",children:[s.label,s.required&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("p",{className:"text-sm text-gray-500",children:t?`Uploaded ${new Date(t.created_date).toLocaleDateString()}`:"Not uploaded"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t?e.jsxs(e.Fragment,{children:[f(t.verified_status),e.jsx(p,{className:j(t.verified_status),children:t.verified_status})]}):e.jsx(p,{className:"bg-gray-100 text-gray-800",children:"Missing"})})]},s.value)})})})]}),c.length>0&&e.jsxs(_,{className:"border-none shadow-lg",children:[e.jsx(D,{children:e.jsx(w,{children:"Uploaded Documents"})}),e.jsx(S,{children:e.jsx("div",{className:"space-y-4",children:c.map(s=>{const t=d.find(r=>r.value===s.doc_type);return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(N,{className:"w-8 h-8 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:(t==null?void 0:t.label)||s.doc_type}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Uploaded ",new Date(s.created_date).toLocaleDateString()]}),s.notes&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("strong",{children:"Notes:"})," ",s.notes]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[f(s.verified_status),e.jsx(p,{className:j(s.verified_status),children:s.verified_status})]})]},s.id)})})})]}),e.jsx(T,{open:L,onOpenChange:i,children:e.jsxs(A,{children:[e.jsx(G,{children:e.jsx(H,{children:"Upload Document"})}),e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Document Type"}),e.jsxs(V,{value:a.doc_type,onValueChange:s=>o(t=>({...t,doc_type:s})),children:[e.jsx(X,{children:e.jsx(J,{placeholder:"Select document type"})}),e.jsx(M,{children:d.map(s=>e.jsxs(Q,{value:s.value,children:[s.label," ",s.required&&"*"]},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload File"}),e.jsx(W,{type:"file",onChange:s=>o(t=>({...t,file:s.target.files[0]})),accept:".pdf,.jpg,.jpeg,.png,.doc,.docx",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Supported formats: PDF, JPG, PNG, DOC, DOCX"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes (Optional)"}),e.jsx(Y,{value:a.notes,onChange:s=>o(t=>({...t,notes:s.target.value})),placeholder:"Additional notes about this document...",rows:3})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(x,{type:"button",variant:"outline",onClick:()=>i(!1),disabled:m,children:"Cancel"}),e.jsxs(x,{type:"submit",disabled:m||!a.doc_type||!a.file,children:[m?e.jsx(y,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Upload Document"]})]})]})]})})]})})})})}export{pe as default};
