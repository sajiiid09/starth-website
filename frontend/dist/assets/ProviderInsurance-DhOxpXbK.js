import{r,U as V,ao as J,aw as v,t as g,j as e,y as N,B as l,a4 as _,a as c,at as Q,ak as Y,al as K,am as W,an as Z,I as p,T as ee,N as w,aH as ae,av as se,_ as te,b as re}from"./index-KrjukJeb.js";import{C as h,c as b}from"./card-tLMu1Ov7.js";import{P,a as C,b as S,C as D}from"./popover-BG0fWMNa.js";import{n as ie}from"./Clock.es-CCh8QZyI.js";import{s as I}from"./Shield.es-C51nR2_i.js";import{m as M}from"./WarningCircle.es-6KbXsyM7.js";import{R as E}from"./RoleGuard-DRkcvV5M.js";import{P as k}from"./ProviderPortalLayout-D3ZJZ5Ow.js";import{f as x}from"./isSameMonth-Ccyd4klX.js";import"./en-US-B77o_Iq_.js";import"./differenceInCalendarMonths-DCHHw2al.js";import"./Envelope.es-BErI3QgS.js";function je(){const[U,$]=r.useState(null),[o,T]=r.useState(null),[j,L]=r.useState([]),[q,O]=r.useState(!0),[z,m]=r.useState(!1),[u,y]=r.useState(!1),[t,i]=r.useState({carrier:"",policy_number:"",coverage_types:"",start_date:null,end_date:null,certificate:null});r.useEffect(()=>{f()},[]);const f=async()=>{try{const a=await V.me();$(a);const s=await J.filter({owner_user_id:a.id,type:"service_provider"});if(s.length>0){T(s[0]);const n=await v.filter({org_id:s[0].id});L(n)}}catch(a){console.error("Error fetching insurance data:",a),g.error("Failed to load insurance policies")}O(!1)},F=()=>{i({carrier:"",policy_number:"",coverage_types:"",start_date:null,end_date:null,certificate:null})},G=async a=>{if(a.preventDefault(),!(!o||!t.certificate)){y(!0);try{const{file_url:s}=await ae({file:t.certificate}),n=await se.create({org_id:o.id,entity_type:"organization",entity_id:o.id,doc_type:"insurance_certificate",storage_url:s,uploaded_by:U.id,verified_status:"pending"}),d={org_id:o.id,carrier:t.carrier,policy_number:t.policy_number,coverage_types:t.coverage_types.split(",").map(H=>H.trim()),start_date:t.start_date.toISOString().split("T")[0],end_date:t.end_date.toISOString().split("T")[0],certificate_doc_id:n.id,status:"pending"};await v.create(d);const X=`
        A new insurance policy has been uploaded for approval.
        <br><br>
        <strong>Organization:</strong> ${o.name}<br>
        <strong>Carrier:</strong> ${t.carrier}<br>
        <strong>Policy Number:</strong> ${t.policy_number}<br>
        <strong>Coverage:</strong> ${t.coverage_types}<br>
        <strong>Valid Until:</strong> ${x(t.end_date,"PPP")}<br>
        <strong>File:</strong> ${t.certificate.name}<br><br>
        Please review and approve in the admin dashboard.
      `;await te({to:"info@renzairegroup.com",subject:`Insurance Policy Uploaded for Approval: ${o.name}`,body:X}),g.success("Insurance policy uploaded and submitted for approval"),m(!1),F(),f()}catch(s){console.error("Error uploading insurance:",s),g.error("Failed to upload insurance policy")}y(!1)}},A=a=>{switch(a){case"verified":return e.jsx(re,{className:"w-5 h-5 text-green-600"});case"expired":case"rejected":return e.jsx(M,{className:"w-5 h-5 text-red-600"});default:return e.jsx(ie,{className:"w-5 h-5 text-yellow-600"})}},B=a=>{const s={verified:"bg-green-100 text-green-800",expired:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800",pending:"bg-yellow-100 text-yellow-800"};return s[a]||s.pending},R=a=>{const s=new Date,n=new Date(a),d=Math.ceil((Number(n)-Number(s))/(1e3*60*60*24));return d<=30&&d>0};return q?e.jsx(E,{requiredRole:"service_provider",children:e.jsx(k,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(N,{className:"w-8 h-8 animate-spin text-gray-500"})})})}):e.jsx(E,{requiredRole:"service_provider",children:e.jsx(k,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Insurance"}),e.jsx("p",{className:"text-gray-600",children:"Manage your insurance policies"})]}),e.jsxs(l,{onClick:()=>m(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Add Policy"]})]}),e.jsx(h,{className:"border-2 border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 mb-6 shadow-lg",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:"https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/68d4e38c341adad3b24950ed/1d251d1b8_Screenshot2025-12-09at101157.png",alt:"NEXT Insurance",className:"w-24 h-auto flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"NEXT Insurance"}),e.jsx(c,{className:"bg-blue-600 text-white",children:"Partner"})]}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Protect your service business with comprehensive coverage from our trusted partner. Get instant quotes and certificates in minutes."}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(c,{variant:"secondary",children:"✓ General Liability"}),e.jsx(c,{variant:"secondary",children:"✓ Professional Liability"}),e.jsx(c,{variant:"secondary",children:"✓ Equipment Coverage"}),e.jsx(c,{variant:"secondary",children:"✓ Starting at $300/year"})]}),e.jsxs(l,{onClick:()=>window.open("https://www.nextinsurance.com","_blank"),className:"bg-blue-600 hover:bg-blue-700",children:["Get a Quote from NEXT",e.jsx(Q,{className:"w-4 h-4 ml-2"})]})]})]})})}),j.length>0?e.jsx("div",{className:"space-y-6",children:j.map(a=>{const s=R(a.end_date);return e.jsx(h,{className:"border-none shadow-lg",children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx(I,{className:"w-8 h-8 text-blue-600 mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:a.carrier}),e.jsxs("p",{className:"text-gray-600 mb-3",children:["Policy #",a.policy_number]}),a.coverage_types&&a.coverage_types.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Coverage Types:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.coverage_types.map((n,d)=>e.jsx(c,{variant:"secondary",children:n},d))})]}),e.jsx("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:e.jsxs("span",{children:[e.jsx("strong",{children:"Valid:"})," ",x(new Date(a.start_date),"MMM d, yyyy")," - ",x(new Date(a.end_date),"MMM d, yyyy")]})}),s&&e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("p",{className:"text-yellow-800 text-sm",children:[e.jsx(M,{className:"w-4 h-4 inline mr-1"}),"This policy expires in ",Math.ceil((Number(new Date(a.end_date))-Number(new Date))/(1e3*60*60*24))," days"]})})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[A(a.status),e.jsx(c,{className:B(a.status),children:a.status})]})]})})},a.id)})}):e.jsx(h,{className:"border-none shadow-lg",children:e.jsxs(b,{className:"p-12 text-center",children:[e.jsx(I,{className:"w-16 h-16 text-gray-400 mx-auto mb-6"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-3",children:"No insurance policies"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Add your insurance policy to verify your coverage"}),e.jsxs(l,{onClick:()=>m(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Add Your First Policy"]})]})}),e.jsx(Y,{open:z,onOpenChange:m,children:e.jsxs(K,{className:"max-w-md",children:[e.jsx(W,{children:e.jsx(Z,{children:"Add Insurance Policy"})}),e.jsxs("form",{onSubmit:G,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Insurance Carrier"}),e.jsx(p,{value:t.carrier,onChange:a=>i(s=>({...s,carrier:a.target.value})),placeholder:"e.g., Lloyd's of London",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Policy Number"}),e.jsx(p,{value:t.policy_number,onChange:a=>i(s=>({...s,policy_number:a.target.value})),placeholder:"e.g., POL12345678",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Coverage Types (comma-separated)"}),e.jsx(ee,{value:t.coverage_types,onChange:a=>i(s=>({...s,coverage_types:a.target.value})),placeholder:"e.g., General Liability, Professional Liability",rows:2,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),e.jsxs(P,{children:[e.jsx(C,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),t.start_date?x(t.start_date,"MMM d, yyyy"):"Select date"]})}),e.jsx(S,{className:"w-auto p-0",align:"start",children:e.jsx(D,{mode:"single",selected:t.start_date,onSelect:a=>i(s=>({...s,start_date:a}))})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),e.jsxs(P,{children:[e.jsx(C,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"w-full justify-start text-left",children:[e.jsx(w,{className:"mr-2 h-4 w-4"}),t.end_date?x(t.end_date,"MMM d, yyyy"):"Select date"]})}),e.jsx(S,{className:"w-auto p-0",align:"start",children:e.jsx(D,{mode:"single",selected:t.end_date,onSelect:a=>i(s=>({...s,end_date:a}))})})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Upload Certificate"}),e.jsx(p,{type:"file",onChange:a=>i(s=>({...s,certificate:a.target.files[0]})),accept:".pdf,.jpg,.jpeg,.png",required:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Supported formats: PDF, JPG, PNG"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>m(!1),disabled:u,children:"Cancel"}),e.jsxs(l,{type:"submit",disabled:u||!t.certificate,children:[u?e.jsx(N,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Upload Policy"]})]})]})]})})]})})})})}export{je as default};
