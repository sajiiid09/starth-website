import{r as n,j as e,y as de,a2 as ue,ar as $,as as me,B as z,e as R,b as F,L as E,a4 as ve,at as xe,U as ge,ao as he,a9 as fe,x as U,au as pe,av as je,aw as Ne,ap as be,R as ye}from"./index-KrjukJeb.js";import{C as k,c as C,a as Se,b as we}from"./card-tLMu1Ov7.js";import{P as V}from"./progress-gnpwNbNM.js";import{m as Pe}from"./CurrencyDollar.es-CPzZPXmX.js";import{s as _e}from"./Shield.es-C51nR2_i.js";import{c as G}from"./TrendUp.es-DxtztzU8.js";import{m as H}from"./WarningCircle.es-6KbXsyM7.js";import{R as W}from"./RoleGuard-DRkcvV5M.js";import{P as J}from"./ProviderPortalLayout-D3ZJZ5Ow.js";import"./Envelope.es-BErI3QgS.js";function qe(){const[p,K]=n.useState(null),[Re,Q]=n.useState(null),[ke,X]=n.useState([]),[Ce,Z]=n.useState([]),[De,ee]=n.useState([]),[Le,se]=n.useState([]),[I,te]=n.useState(!0),[d,re]=n.useState({profile:0,services:0,documents:0,insurance:0,overall:0}),[u,ae]=n.useState({services:0,activeServices:0,bookings:0,revenue:0,messages:0,monthlyRevenue:0,pendingLeads:0});if(n.useEffect(()=>{const s=(o,m,v,t,x)=>{let r=0;o&&(o.name&&(r+=25),o.description&&(r+=25),o.website&&(r+=25),o.business_license&&(r+=25));const w=m.length+x.length>0?100:0,g=["identity","business_license"],N=[...new Set(v.filter(i=>i.verified_status==="verified").map(i=>i.doc_type))],h=Math.round(N.filter(i=>g.includes(i)).length/g.length*100),l=t.find(i=>{const P=new Date,D=new Date(i.end_date);return i.status==="verified"&&D>=P})?100:0,b=Math.round((r+w+h+l)/4);re({profile:r,services:w,documents:h,insurance:l,overall:b})};(async()=>{var o,m,v;try{const t=await ge.me();K(t);const[x,r]=await Promise.allSettled([he.filter({owner_user_id:t.id,type:"service_provider"}),fe.filter({user_id:t.id})]);let a=null;x.status==="fulfilled"&&x.value.length>0?(a=x.value[0],Q(a)):x.status==="rejected"&&console.error("ProviderPortal: Failed to load organization:",x.reason);const w=r.status==="fulfilled"?r.value:[];r.status==="rejected"&&console.error("ProviderPortal: Failed to load conversations:",r.reason);const[g,N,h,y]=await Promise.allSettled([a?U.filter({org_id:a.id}):U.filter({provider_id:t.id}),pe.filter({owner_id:t.id}),a?je.filter({org_id:a.id}):Promise.resolve([]),a?Ne.filter({org_id:a.id}):Promise.resolve([])]);let l=g.status==="fulfilled"?g.value:[];g.status==="rejected"&&console.error("ProviderPortal: Failed to load services:",g.reason),l.length===0&&a&&(l=await U.filter({provider_id:t.id}).catch(_=>(console.error("ProviderPortal: Fallback service search failed:",_),[])));const b=N.status==="fulfilled"?N.value:[];N.status==="rejected"&&console.error("ProviderPortal: Failed to load service providers:",N.reason);const i=h.status==="fulfilled"?h.value:[];h.status==="rejected"&&console.error("ProviderPortal: Failed to load documents:",h.reason);const P=y.status==="fulfilled"?y.value:[];y.status==="rejected"&&console.error("ProviderPortal: Failed to load insurance:",y.reason),X(l),Z(b),ee(i),se(P);const D=l.length+b.length,ne=l.filter(c=>c.status==="active").length+b.filter(c=>c.status==="approved").length;let A=0,M=0,O=0,T=0;try{const c=await be.filter({provider_id:t.id}),_=Array.isArray(c)?c:[];A=_.length;const Y=new Date,le=Y.getMonth(),ce=Y.getFullYear();for(const f of _){const q=Number(((o=f.data)==null?void 0:o.total_amount)??f.total_amount??((m=f.data)==null?void 0:m.agreed_price)??0);M+=q;const L=f.created_at?new Date(f.created_at):null;L&&L.getMonth()===le&&L.getFullYear()===ce&&(O+=q);const B=String(((v=f.data)==null?void 0:v.status)??f.status??"");(B==="pending"||B==="requested")&&T++}}catch(c){console.error("ProviderPortal: Failed to load bookings:",c)}ae({services:D,activeServices:ne,bookings:A,revenue:M,monthlyRevenue:O,messages:w.length,pendingLeads:T}),s(a,l,i,P,b)}catch(t){console.error("Error fetching provider data:",t)}te(!1)})()},[]),I)return e.jsx(W,{requiredRole:"service_provider",children:e.jsx(J,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(de,{className:"w-8 h-8 animate-spin text-gray-500"})})})});const S=({title:s,value:j,icon:o,description:m,trend:v,color:t="blue"})=>e.jsxs(k,{className:"border-none shadow-lg hover:shadow-xl transition-shadow",children:[e.jsxs(Se,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(we,{className:"text-sm font-medium text-gray-600",children:s}),e.jsx("div",{className:`p-2 rounded-lg bg-${t}-100`,children:ye.cloneElement(o,{className:`h-4 w-4 text-${t}-600`})})]}),e.jsxs(C,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:j}),e.jsxs("div",{className:"flex items-center justify-between",children:[m&&e.jsx("p",{className:"text-xs text-gray-500",children:m}),v&&e.jsxs("div",{className:"flex items-center text-green-600 text-xs",children:[e.jsx(G,{className:"w-3 h-3 mr-1"}),v]})]})]})]}),ie=s=>s===100?{status:"complete",color:"text-green-600",icon:F}:s>0?{status:"progress",color:"text-yellow-600",icon:H}:{status:"pending",color:"text-gray-400",icon:H},oe=[{title:"Organization Profile",description:"Complete your business information",score:d.profile,link:"ProviderOrganization",icon:ue},{title:"Services",description:"Add your service offerings",score:d.services,link:"ProviderServices",icon:$},{title:"Documents",description:"Upload required verification documents",score:d.documents,link:"ProviderDocuments",icon:me},{title:"Insurance",description:"Provide insurance certificate",score:d.insurance,link:"ProviderInsurance",icon:_e}];return e.jsx(W,{requiredRole:"service_provider",children:e.jsx(J,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Service Provider Dashboard"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Welcome to your provider portal. Complete your setup to start receiving leads."})]}),(p==null?void 0:p.roles)&&p.roles.length>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Switch to:"}),e.jsxs("div",{className:"flex gap-2",children:[p.roles.includes("organizer")&&e.jsx(z,{variant:"outline",size:"sm",onClick:()=>{localStorage.setItem("activeRole","organizer"),window.location.href=R("Dashboard")},children:"Organizer"}),p.roles.includes("venue_owner")&&e.jsx(z,{variant:"outline",size:"sm",onClick:()=>{localStorage.setItem("activeRole","venue_owner"),window.location.href=R("VenuePortal")},children:"Venue Owner"})]})]})]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-8",children:[e.jsx(S,{title:"Total Services",value:u.services,icon:e.jsx($,{}),description:`${u.activeServices} active listings`,color:"blue"}),e.jsx(S,{title:"Total Bookings",value:u.bookings,icon:e.jsx(F,{}),description:`${u.pendingLeads} pending`,color:"green"}),e.jsx(S,{title:"Total Revenue",value:u.revenue.toLocaleString("en-US",{style:"currency",currency:"USD"}),icon:e.jsx(Pe,{}),description:"All-time earnings",color:"purple"}),e.jsx(S,{title:"This Month",value:u.monthlyRevenue.toLocaleString("en-US",{style:"currency",currency:"USD"}),icon:e.jsx(G,{}),description:"Current month revenue",color:"orange"})]}),u.services===0&&!I&&e.jsx(k,{className:"border-dashed border-2 border-gray-300 shadow-none mb-8",children:e.jsxs(C,{className:"p-6 text-center",children:[e.jsx($,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"font-semibold text-lg text-gray-800",children:"You haven't added any services yet"}),e.jsx("p",{className:"text-gray-600 mt-2 mb-4",children:"Add your service offerings to get started and appear in our marketplace."}),e.jsx(E,{to:R("ProviderServices"),children:e.jsxs(z,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Add Your First Service"]})})]})}),e.jsx(k,{className:"border-none shadow-lg mb-8",children:e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Setup Progress"}),e.jsx("p",{className:"text-gray-600",children:"Complete all steps to appear in our marketplace"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-gray-900",children:[d.overall,"%"]}),e.jsx("div",{className:"text-sm text-gray-500",children:"Complete"})]})]}),e.jsx(V,{value:d.overall,className:"h-3"}),d.overall===100&&e.jsxs("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-800",children:[e.jsx(F,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Setup Complete!"})]}),e.jsx("p",{className:"text-green-700 text-sm mt-1",children:"Your profile is complete and will appear in our marketplace after admin approval."})]})]})}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:oe.map(s=>{const j=ie(s.score);return e.jsx(E,{to:R(s.link),children:e.jsx(k,{className:"border-none shadow-lg hover:shadow-xl transition-shadow cursor-pointer",children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:`p-2 rounded-lg ${j.status==="complete"?"bg-green-100":j.status==="progress"?"bg-yellow-100":"bg-gray-100"}`,children:e.jsx(s.icon,{className:`w-6 h-6 ${j.color}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:s.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{value:s.score,className:"h-2 flex-1"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:[s.score,"%"]})]})]})]}),e.jsx(xe,{className:"w-5 h-5 text-gray-400"})]})})})},s.title)})})]})})})})}export{qe as default};
