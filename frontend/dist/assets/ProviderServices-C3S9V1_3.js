import{r as l,U as Z,ao as ee,x as m,t as n,j as e,y as A,I as c,B as u,a4 as D,ar as E,a as ae,ak as te,al as se,am as re,an as ie,Q as M,W as F,X as L,Y as T,Z as I,T as P,_ as ne,b as oe}from"./index-KrjukJeb.js";import{C as V,c as B}from"./card-tLMu1Ov7.js";import{S as le}from"./switch-HwOEIoQi.js";import{C as ce}from"./checkbox-uGjIcrta.js";import{n as de}from"./Clock.es-CCh8QZyI.js";import{f as me}from"./MagnifyingGlass.es-Dx2DBm8Z.js";import{m as f}from"./Pencil.es-DgXKeFuK.js";import{n as ue}from"./Trash.es-DHM9Kd3t.js";import{m as ge}from"./WarningCircle.es-6KbXsyM7.js";import{R as O}from"./RoleGuard-DRkcvV5M.js";import{P as $}from"./ProviderPortalLayout-D3ZJZ5Ow.js";import"./Envelope.es-BErI3QgS.js";import"./Shield.es-C51nR2_i.js";const Q=["Venue","Food & Beverage","Decor","Entertainment & Media","Transportation","Beauty and Fashion","Catering","Event Management","Rentals","Lighting & Effects","Invitations & Printing","Jewelry & Accessories","Gifts & Souvenirs","Bakery & Cakes","Drinks & Beverages","Security & Bouncers","Event Technology (AV/Stage)","Florist & Fresh Flowers","Photography & Videography","Kids Entertainment","Fireworks & Special Effects","Makeup & Styling","Event Furniture","Audio & DJ Services","Live Performers & Bands","Cultural Performances","Travel & Tour Packages","Destination Management","Health & Wellness","Childcare & Babysitting","Cleaning & Housekeeping","Event Insurance","Transportation – Luxury Cars","Transportation – Limousines","Transportation – Buses","Stage & Set Design"],he={corporate:["Venue","Catering","Event Technology (AV/Stage)","Event Management","Transportation","Audio & DJ Services"],wedding:["Venue","Catering","Photography & Videography","Florist & Fresh Flowers","Entertainment & Media","Beauty and Fashion","Bakery & Cakes"],social:["Venue","Entertainment & Media","Catering","Photography & Videography","Audio & DJ Services","Decor"],conference:["Venue","Event Technology (AV/Stage)","Catering","Event Management","Transportation"],all:Q},be=[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}];function De(){const[b,R]=l.useState(null),[x,W]=l.useState(null),[v,p]=l.useState([]),[z,N]=l.useState(!0),[H,g]=l.useState(!1),[d,_]=l.useState(null),[s,i]=l.useState({name:"",category:"",description:"",city:"",state:"",coverage_regions:[],rate_card_json:{base_rate:"",hourly_rate:"",notes:""},website:"",event_types:[],searchQuery:""}),[y,w]=l.useState(!1);l.useEffect(()=>{j()},[]);const j=async()=>{N(!0);try{const a=await Z.me();R(a);const t=await ee.filter({owner_user_id:a.id,type:"service_provider"});let r=null;t.length>0&&(r=t[0],W(r));let o=[];r&&(o=await m.filter({org_id:r.id})),o.length===0&&(o=await m.filter({provider_id:a.id})),console.log("Fetched services on Services page:",o),p(o)}catch(a){console.error("Error fetching services data:",a),n.error("Failed to load services")}N(!1)},S=()=>{i({name:"",category:"",description:"",city:"",state:"",coverage_regions:[],rate_card_json:{base_rate:"",hourly_rate:"",notes:""},website:"",event_types:[],searchQuery:""}),_(null)},C=()=>{S(),g(!0)},U=a=>{i({name:a.name||"",category:a.category||"",description:a.description||"",city:a.city||"",state:a.state||"",coverage_regions:a.coverage_regions||[],rate_card_json:a.rate_card_json||{base_rate:"",hourly_rate:"",notes:""},website:a.website||"",event_types:a.event_types||[],searchQuery:""}),_(a),g(!0)},q=async a=>{if(window.confirm("Are you sure you want to delete this service?"))try{await m.delete(a),n.success("Service deleted successfully"),j()}catch(t){console.error("Error deleting service:",t),n.error("Failed to delete service")}},K=async a=>{if(a.preventDefault(),!x){n.error("No organization found. Please create one first.");return}w(!0);const t={...s,city:s.city,state:s.state,coverage_regions:typeof s.coverage_regions=="string"?s.coverage_regions.split(",").map(r=>r.trim()).filter(Boolean):s.coverage_regions.filter(Boolean),rate_card_json:{base_rate:parseFloat(s.rate_card_json.base_rate)||0,hourly_rate:parseFloat(s.rate_card_json.hourly_rate)||0,notes:s.rate_card_json.notes||""},status:d?d.status:"draft",org_id:x.id,provider_id:b.id};try{d?(await m.update(d.id,t),n.success("Service updated successfully!")):(await m.create(t),n.success("Service created successfully!")),j(),g(!1),S()}catch(r){console.error("Error saving service:",r),n.error("Failed to save service.")}w(!1)},J=async(a,t)=>{const r=t?"submitted":"hidden",o=[...v],X=v.map(h=>h.id===a.id?{...h,status:r}:h);p(X);try{await m.update(a.id,{status:r}),n.success(`Service status updated to ${r}.`),r==="submitted"&&(await ne({to:"info@renzairegroup.com",subject:`Service Submission for Approval: ${a.name}`,body:`
            <p>A service has been submitted for approval:</p>
            <ul>
              <li><strong>Service Name:</strong> ${a.name}</li>
              <li><strong>Provider:</strong> ${b.full_name} (${b.email})</li>
              <li><strong>Organization:</strong> ${x.name}</li>
            </ul>
            <p>Please review and approve it in the admin dashboard.</p>
          `}),n.info("An approval request has been sent to the admin."))}catch(h){console.error("Failed to update status:",h),n.error("Failed to update service status."),p(o)}},Y=a=>{switch(a){case"draft":return{icon:f,color:"text-gray-500",label:"Draft"};case"submitted":return{icon:de,color:"text-yellow-600",label:"Pending Approval"};case"active":return{icon:oe,color:"text-green-600",label:"Live"};case"hidden":return{icon:ge,color:"text-red-600",label:"Hidden"};default:return{icon:f,color:"text-gray-500",label:"Unknown"}}},G=a=>{i(t=>{const r=t.event_types.includes(a)?t.event_types.filter(o=>o!==a):[...t.event_types,a];return{...t,event_types:r}})},k=v.filter(a=>a.name.toLowerCase().includes(s.searchQuery.toLowerCase())||a.category.toLowerCase().includes(s.searchQuery.toLowerCase())||a.description.toLowerCase().includes(s.searchQuery.toLowerCase())||a.city&&a.city.toLowerCase().includes(s.searchQuery.toLowerCase())||a.state&&a.state.toLowerCase().includes(s.searchQuery.toLowerCase())||a.coverage_regions&&a.coverage_regions.some(t=>t.toLowerCase().includes(s.searchQuery.toLowerCase())));return z?e.jsx(O,{requiredRole:"service_provider",children:e.jsx($,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(A,{className:"w-8 h-8 animate-spin text-gray-500"})})})}):e.jsx(O,{requiredRole:"service_provider",children:e.jsx($,{children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center mb-8 gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Services"}),e.jsx("p",{className:"text-gray-600",children:"Manage your service offerings"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-500"}),e.jsx(c,{type:"text",placeholder:"Search services...",value:s.searchQuery,onChange:a=>i(t=>({...t,searchQuery:a.target.value})),className:"pl-9"})]}),e.jsxs(u,{onClick:C,className:"bg-blue-600 hover:bg-blue-700 whitespace-nowrap",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Add Service"]})]})]}),k.length>0?e.jsx("div",{className:"grid gap-6",children:k.map(a=>{const t=Y(a.status);return e.jsx(V,{className:"border-none shadow-md hover:shadow-lg transition-shadow",children:e.jsx(B,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-start gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(E,{className:"w-5 h-5 text-gray-500"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.name})]}),e.jsx(ae,{variant:"outline",className:"mb-2",children:a.category}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:a.description}),(a.city||a.state)&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[e.jsx("strong",{children:"Location:"})," ",a.city,a.city&&a.state?", ":"",a.state]}),a.coverage_regions&&a.coverage_regions.length>0&&e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("strong",{children:"Additional Coverage:"})," ",a.coverage_regions.join(", ")]})]}),e.jsxs("div",{className:"flex-shrink-0 flex flex-col items-end gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Marketplace Status"}),e.jsx(le,{checked:a.status==="active"||a.status==="submitted",onCheckedChange:r=>J(a,r),disabled:a.status==="active"||a.status==="draft"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:`w-4 h-4 ${t.color}`}),e.jsx("span",{className:`text-sm font-medium ${t.color}`,children:t.label})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>U(a),children:[e.jsx(f,{className:"w-3 h-3 mr-1"})," Edit"]}),e.jsxs(u,{variant:"destructive",size:"sm",onClick:()=>q(a.id),children:[e.jsx(ue,{className:"w-3 h-3 mr-1"})," Delete"]})]})]})]})})},a.id)})}):e.jsx(V,{className:"border-none shadow-lg",children:e.jsxs(B,{className:"p-12 text-center",children:[e.jsx(E,{className:"w-16 h-16 text-gray-400 mx-auto mb-6"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-3",children:"No services yet"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Add your first service to start receiving leads"}),e.jsxs(u,{onClick:C,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Add Your First Service"]})]})}),e.jsx(te,{open:H,onOpenChange:g,children:e.jsxs(se,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(re,{children:e.jsx(ie,{children:d?"Edit Service":"Add New Service"})}),e.jsxs("form",{onSubmit:K,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Service Name"}),e.jsx(c,{value:s.name,onChange:a=>i(t=>({...t,name:a.target.value})),placeholder:"e.g., Wedding Photography",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"City"}),e.jsx(c,{value:s.city,onChange:a=>i(t=>({...t,city:a.target.value})),placeholder:"e.g., Boston",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"State"}),e.jsxs(M,{value:s.state,onValueChange:a=>i(t=>({...t,state:a})),required:!0,children:[e.jsx(F,{children:e.jsx(L,{placeholder:"Select state"})}),e.jsx(T,{className:"max-h-60",children:be.map(a=>e.jsx(I,{value:a.abbreviation,children:a.name},a.abbreviation))})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Event Types"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 mb-3",children:Object.keys(he).filter(a=>a!=="all").map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{id:a,checked:s.event_types.includes(a),onCheckedChange:()=>G(a)}),e.jsx("label",{htmlFor:a,className:"text-sm capitalize",children:a})]},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Service Category"}),e.jsxs(M,{value:s.category,onValueChange:a=>i(t=>({...t,category:a})),required:!0,children:[e.jsx(F,{children:e.jsx(L,{placeholder:"Select a category"})}),e.jsx(T,{className:"max-h-60",children:Q.map(a=>e.jsx(I,{value:a,children:a},a))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx(P,{value:s.description,onChange:a=>i(t=>({...t,description:a.target.value})),placeholder:"Describe your service...",rows:3,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Coverage Areas (Optional)"}),e.jsx(c,{value:Array.isArray(s.coverage_regions)?s.coverage_regions.join(", "):s.coverage_regions,onChange:a=>i(t=>({...t,coverage_regions:a.target.value})),placeholder:"e.g., Cambridge, Newton, Somerville"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Additional cities or regions you serve beyond your primary location"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Website (Optional)"}),e.jsx(c,{type:"url",value:s.website,onChange:a=>i(t=>({...t,website:a.target.value})),placeholder:"https://yourwebsite.com"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Base Rate ($)"}),e.jsx(c,{type:"number",value:s.rate_card_json.base_rate,onChange:a=>i(t=>({...t,rate_card_json:{...t.rate_card_json,base_rate:a.target.value}})),placeholder:"Starting price"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hourly Rate ($)"}),e.jsx(c,{type:"number",value:s.rate_card_json.hourly_rate,onChange:a=>i(t=>({...t,rate_card_json:{...t.rate_card_json,hourly_rate:a.target.value}})),placeholder:"Per hour rate"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pricing Notes"}),e.jsx(P,{value:s.rate_card_json.notes,onChange:a=>i(t=>({...t,rate_card_json:{...t.rate_card_json,notes:a.target.value}})),placeholder:"Additional pricing information...",rows:2})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>g(!1),disabled:y,children:"Cancel"}),e.jsxs(u,{type:"submit",disabled:y,className:"bg-blue-600 hover:bg-blue-700",children:[y?e.jsx(A,{className:"w-4 h-4 mr-2 animate-spin"}):null,d?"Update Service":"Add Service"]})]})]})]})})]})})})})}export{De as default};
