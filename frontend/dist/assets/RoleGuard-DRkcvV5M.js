import{r as c,j as e,n as b,a2 as N,O as d,I as y,Q as C,W as S,X as R,Y as z,Z as m,T as U,B as A,y as f,at as I,ao as O,U as j}from"./index-KrjukJeb.js";import{C as T,a as E,b as F,c as _}from"./card-tLMu1Ov7.js";function D({user:u,requiredRole:n,onRoleActivated:g}){const[l,h]=c.useState(!1),[t,x]=c.useState({organizationName:"",website:"",city:"",country:"",description:""}),i={venue_owner:{title:"Activate Venue Owner Role",description:"List and manage your venues on our marketplace",icon:N,organizationType:"venue_owner"},service_provider:{title:"Activate Service Provider Role",description:"Offer your services to event organizers",icon:b,organizationType:"service_provider"}}[n],o=(s,a)=>{x(v=>({...v,[s]:a}))},r=async s=>{if(s.preventDefault(),!(!t.organizationName||!t.city||!t.country)){h(!0);try{await O.create({owner_user_id:u.id,name:t.organizationName,website:t.website,city:t.city,country:t.country,type:i.organizationType,description:t.description});const a=u.roles||["organizer"];a.includes(n)||(a.push(n),await j.updateMyUserData({roles:a})),g()}catch(a){console.error("Error activating role:",a)}h(!1)}};return i?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs(T,{className:"w-full max-w-2xl",children:[e.jsxs(E,{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(i.icon,{className:"w-8 h-8 text-blue-600"})}),e.jsx(F,{className:"text-2xl",children:i.title}),e.jsx("p",{className:"text-gray-600",children:i.description})]}),e.jsx(_,{children:e.jsxs("form",{onSubmit:r,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"organizationName",children:"Organization Name *"}),e.jsx(y,{id:"organizationName",value:t.organizationName,onChange:s=>o("organizationName",s.target.value),placeholder:"Enter your business or organization name",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"city",children:"City *"}),e.jsx(y,{id:"city",value:t.city,onChange:s=>o("city",s.target.value),placeholder:"City",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"country",children:"Country *"}),e.jsxs(C,{value:t.country,onValueChange:s=>o("country",s),children:[e.jsx(S,{children:e.jsx(R,{placeholder:"Select country"})}),e.jsxs(z,{children:[e.jsx(m,{value:"US",children:"United States"}),e.jsx(m,{value:"CA",children:"Canada"}),e.jsx(m,{value:"UK",children:"United Kingdom"}),e.jsx(m,{value:"AU",children:"Australia"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"website",children:"Website (Optional)"}),e.jsx(y,{id:"website",type:"url",value:t.website,onChange:s=>o("website",s.target.value),placeholder:"https://yourwebsite.com"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"description",children:"Business Description (Optional)"}),e.jsx(U,{id:"description",value:t.description,onChange:s=>o("description",s.target.value),placeholder:"Tell us about your business...",rows:3})]}),e.jsxs(A,{type:"submit",className:"w-full",disabled:l||!t.organizationName||!t.city||!t.country,children:[l?e.jsx(f,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(I,{className:"w-4 h-4 mr-2"}),l?"Creating Organization...":"Activate Role"]})]})})]})}):e.jsx("div",{children:"Invalid role requested"})}function B({children:u,requiredRole:n}){const[g,l]=c.useState(null),[h,t]=c.useState(!0),[x,p]=c.useState(!1),i=c.useCallback(async()=>{var r,s;try{const a=await j.me();l(a);const w=(a.roles||["organizer"]).includes(n);p(w),t(!1)}catch(a){if((r=a.message)!=null&&r.includes("401")||((s=a.response)==null?void 0:s.status)===401){console.log("RoleGuard: User not authenticated, redirecting to login"),localStorage.setItem("postLoginRedirect",window.location.pathname+window.location.search),window.location.href="/api/auth/login";return}console.error("RoleGuard auth check failed:",a),localStorage.setItem("postLoginRedirect",window.location.pathname+window.location.search),window.location.href="/api/auth/login"}},[n]);c.useEffect(()=>{i()},[i]);const o=async()=>{try{const r=await j.me();l(r);const a=(r.roles||["organizer"]).includes(n);p(a)}catch(r){console.error("Error refreshing user data:",r)}};return h?e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(f,{className:"w-8 h-8 animate-spin text-gray-500"})}):x?u:e.jsx(D,{user:g,requiredRole:n,onRoleActivated:o})}export{B as R};
