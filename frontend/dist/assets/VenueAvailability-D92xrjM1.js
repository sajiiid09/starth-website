import{r as d,j as e,y as T,B as Q,N as X,Q as w,W as k,X as S,Y as F,Z as h,O as l,I as i,U as z,ao as H,V as R}from"./index-KrjukJeb.js";import{C as p,c as b,a as V,b as A}from"./card-tLMu1Ov7.js";import{C as Y}from"./checkbox-uGjIcrta.js";import{n as Z}from"./Clock.es-CCh8QZyI.js";import{m as J}from"./CurrencyDollar.es-CPzZPXmX.js";import{m as K}from"./FloppyDisk.es-BgK92nk8.js";import{R as L}from"./RoleGuard-DRkcvV5M.js";import{V as P}from"./VenuePortalLayout-DFmbwPeC.js";import"./Envelope.es-BErI3QgS.js";import"./Shield.es-C51nR2_i.js";const ee=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],_={base_rate:"",hourly_rate:"",half_day_rate:"",full_day_rate:"",weekend_multiplier:"1.5",holiday_multiplier:"2.0",cleaning_fee:"",security_deposit:""},v={available_days:[1,2,3,4,5,6,0],min_booking_hours:"4",max_booking_hours:"12",advance_booking_days:"30",blackout_dates:[],operating_hours:{start:"08:00",end:"22:00"}};function ue(){var M,O;const[f,N]=d.useState([]),[o,x]=d.useState(null),[ae,D]=d.useState(null),[U,W]=d.useState(!0),[B,E]=d.useState(!1),[t,g]=d.useState(_),[n,u]=d.useState(v),y=d.useCallback(a=>{g({..._,...a.rate_card_json||{}}),u({...v,...a.availability_rules_json||{}})},[]);d.useEffect(()=>{(async()=>{try{const s=await z.me(),r=await H.filter({owner_user_id:s.id,type:"venue_owner"});if(r.length>0){D(r[0]);const m=await R.filter({org_id:r[0].id});N(m),m.length>0&&(x(m[0]),y(m[0]))}}catch(s){console.error("Error fetching venues:",s)}W(!1)})()},[y]);const $=a=>{const s=f.find(r=>r.id===a);x(s),s?y(s):(g(_),u(v))},c=(a,s)=>{g(r=>({...r,[a]:s}))},j=(a,s)=>{u(a==="operating_hours"?r=>({...r,operating_hours:{...r.operating_hours,...s}}):r=>({...r,[a]:s}))},I=a=>{u(s=>({...s,available_days:s.available_days.includes(a)?s.available_days.filter(r=>r!==a):[...s.available_days,a]}))},q=async()=>{if(o){E(!0);try{await R.update(o.id,{rate_card_json:t,availability_rules_json:n});const a=await z.me(),s=await H.filter({owner_user_id:a.id,type:"venue_owner"});if(s.length>0){const r=s[0].id,m=await R.filter({org_id:r});N(m);const C=m.find(G=>G.id===o.id);C?(x(C),y(C)):(x(null),g(_),u(v),console.warn("Selected venue not found after save refresh. It might have been deleted."))}else N([]),x(null),D(null),g(_),u(v),console.warn("No organizations found after saving. Data consistency issue or organization removed.")}catch(a){console.error("Error saving venue data:",a)}E(!1)}};return U?e.jsx(L,{requiredRole:"venue_owner",children:e.jsx(P,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(T,{className:"w-8 h-8 animate-spin text-gray-500"})})})}):e.jsx(L,{requiredRole:"venue_owner",children:e.jsx(P,{children:e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Availability & Pricing"}),e.jsx("p",{className:"text-gray-600",children:"Manage your venue calendar and pricing structure"})]}),e.jsxs(Q,{onClick:q,disabled:B||!o,className:"bg-blue-600 hover:bg-blue-700",children:[B?e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(K,{className:"w-4 h-4 mr-2"}),"Save Changes"]})]}),f.length===0?e.jsx(p,{className:"border-none shadow-lg",children:e.jsxs(b,{className:"text-center py-12",children:[e.jsx(X,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-3",children:"No Venues Found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Create a venue first to manage availability and pricing"})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{className:"border-none shadow-lg",children:[e.jsx(V,{children:e.jsx(A,{children:"Select Venue"})}),e.jsx(b,{children:e.jsxs(w,{value:(o==null?void 0:o.id)||"",onValueChange:$,children:[e.jsx(k,{children:e.jsx(S,{placeholder:"Choose a venue to configure"})}),e.jsx(F,{children:f.map(a=>e.jsxs(h,{value:a.id,children:[a.name," - ",a.city]},a.id))})]})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{className:"border-none shadow-lg",children:[e.jsx(V,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-5 h-5 text-green-600"}),"Pricing Structure"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"base_rate",children:"Base Rate (per event)"}),e.jsx(i,{id:"base_rate",type:"number",value:t.base_rate,onChange:a=>c("base_rate",a.target.value),placeholder:"5000"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"hourly_rate",children:"Hourly Rate"}),e.jsx(i,{id:"hourly_rate",type:"number",value:t.hourly_rate,onChange:a=>c("hourly_rate",a.target.value),placeholder:"200"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"half_day_rate",children:"Half Day Rate"}),e.jsx(i,{id:"half_day_rate",type:"number",value:t.half_day_rate,onChange:a=>c("half_day_rate",a.target.value),placeholder:"2500"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"full_day_rate",children:"Full Day Rate"}),e.jsx(i,{id:"full_day_rate",type:"number",value:t.full_day_rate,onChange:a=>c("full_day_rate",a.target.value),placeholder:"4000"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"weekend_multiplier",children:"Weekend Multiplier"}),e.jsxs(w,{value:t.weekend_multiplier,onValueChange:a=>c("weekend_multiplier",a),children:[e.jsx(k,{children:e.jsx(S,{})}),e.jsxs(F,{children:[e.jsx(h,{value:"1.0",children:"1.0x (No increase)"}),e.jsx(h,{value:"1.25",children:"1.25x (+25%)"}),e.jsx(h,{value:"1.5",children:"1.5x (+50%)"}),e.jsx(h,{value:"2.0",children:"2.0x (+100%)"})]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"holiday_multiplier",children:"Holiday Multiplier"}),e.jsxs(w,{value:t.holiday_multiplier,onValueChange:a=>c("holiday_multiplier",a),children:[e.jsx(k,{children:e.jsx(S,{})}),e.jsxs(F,{children:[e.jsx(h,{value:"1.5",children:"1.5x (+50%)"}),e.jsx(h,{value:"2.0",children:"2.0x (+100%)"}),e.jsx(h,{value:"2.5",children:"2.5x (+150%)"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"cleaning_fee",children:"Cleaning Fee"}),e.jsx(i,{id:"cleaning_fee",type:"number",value:t.cleaning_fee,onChange:a=>c("cleaning_fee",a.target.value),placeholder:"500"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"security_deposit",children:"Security Deposit"}),e.jsx(i,{id:"security_deposit",type:"number",value:t.security_deposit,onChange:a=>c("security_deposit",a.target.value),placeholder:"1000"})]})]})]})]}),e.jsxs(p,{className:"border-none shadow-lg",children:[e.jsx(V,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-5 h-5 text-blue-600"}),"Availability Rules"]})}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-base font-medium mb-3 block",children:"Available Days"}),e.jsx("div",{className:"grid grid-cols-4 md:grid-cols-7 gap-2",children:ee.map((a,s)=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{id:`day-${s}`,checked:n.available_days.includes(s),onCheckedChange:()=>I(s)}),e.jsx(l,{htmlFor:`day-${s}`,className:"text-sm cursor-pointer",children:a.substring(0,3)})]},a))})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-base font-medium mb-3 block",children:"Operating Hours"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"start_time",children:"Start Time"}),e.jsx(i,{id:"start_time",type:"time",value:((M=n.operating_hours)==null?void 0:M.start)||"08:00",onChange:a=>j("operating_hours",{...n.operating_hours,start:a.target.value})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"end_time",children:"End Time"}),e.jsx(i,{id:"end_time",type:"time",value:((O=n.operating_hours)==null?void 0:O.end)||"22:00",onChange:a=>j("operating_hours",{...n.operating_hours,end:a.target.value})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"min_hours",children:"Minimum Booking (hours)"}),e.jsx(i,{id:"min_hours",type:"number",value:n.min_booking_hours,onChange:a=>j("min_booking_hours",a.target.value),placeholder:"4"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"max_hours",children:"Maximum Booking (hours)"}),e.jsx(i,{id:"max_hours",type:"number",value:n.max_booking_hours,onChange:a=>j("max_booking_hours",a.target.value),placeholder:"12"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"advance_days",children:"Advance Booking (days)"}),e.jsx(i,{id:"advance_days",type:"number",value:n.advance_booking_days,onChange:a=>j("advance_booking_days",a.target.value),placeholder:"30"})]})]})]})]})]})]})]})})})}export{ue as default};
