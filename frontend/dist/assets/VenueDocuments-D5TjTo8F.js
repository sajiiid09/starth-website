import{r as i,U as g,ao as A,av as c,j as e,y as h,a as d,as as n,b as B,B as f,aj as E,A as S}from"./index-KrjukJeb.js";import{C as G,a as L,b as R,c as V}from"./card-tLMu1Ov7.js";import{A as k,a as $}from"./alert-8h-S5cZe.js";import{s as I}from"./Upload.es-Dw-8j3Wc.js";import{m as M}from"./WarningCircle.es-6KbXsyM7.js";import{R as j}from"./RoleGuard-DRkcvV5M.js";import{V as y}from"./VenuePortalLayout-DFmbwPeC.js";import"./Envelope.es-BErI3QgS.js";import"./Shield.es-C51nR2_i.js";const N=[{type:"identity",title:"Government ID",description:"Upload government-issued ID (front and back) or passport",required:!0,maxFiles:2},{type:"business_license",title:"Business License",description:"Business license, EIN letter, or incorporation documents",required:!0,maxFiles:1},{type:"floor_plan",title:"Floor Plans",description:"Venue floor plans and layout diagrams",required:!1,maxFiles:5},{type:"permits",title:"Permits & Licenses",description:"Event permits, liquor license, fire department approval",required:!1,maxFiles:3}];function T(){const[m,w]=i.useState([]),[l,v]=i.useState(null),[b,_]=i.useState(!0),[D,x]=i.useState({});i.useEffect(()=>{o()},[]);const o=async()=>{try{const t=await g.me(),a=await A.filter({owner_user_id:t.id,type:"venue_owner"});if(a.length>0){v(a[0]);const r=await c.filter({org_id:a[0].id,entity_type:"organization"});w(r)}}catch(t){console.error("Error fetching documents:",t)}_(!1)},F=async(t,a)=>{const r=Array.from(t.target.files);if(!(!r.length||!l)){x(s=>({...s,[a]:!0}));try{for(const s of r){const{file_url:z}=await S({file:s});await c.create({org_id:l.id,entity_type:"organization",entity_id:l.id,doc_type:a,storage_url:z,uploaded_by:(await g.me()).id})}await o()}catch(s){console.error("Error uploading documents:",s)}x(s=>({...s,[a]:!1}))}},q=async t=>{try{await c.delete(t),await o()}catch(a){console.error("Error deleting document:",a)}},C=t=>{const a={pending:"bg-yellow-100 text-yellow-800",verified:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"};return a[t]||a.pending},U=t=>m.filter(a=>a.doc_type===t),P=()=>{const t=N.filter(s=>s.required).map(s=>s.type),a=[...new Set(m.map(s=>s.doc_type))];return{completed:t.filter(s=>a.includes(s)).length,total:t.length}};if(b)return e.jsx(j,{requiredRole:"venue_owner",children:e.jsx(y,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(h,{className:"w-8 h-8 animate-spin text-gray-500"})})})});const{completed:p,total:u}=P();return e.jsx(j,{requiredRole:"venue_owner",children:e.jsx(y,{children:e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Document Verification"}),e.jsx("p",{className:"text-gray-600",children:"Upload required documents for marketplace approval"})]}),e.jsxs(d,{className:p===u?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800",children:[p,"/",u," Required Complete"]})]}),e.jsxs(k,{className:"mb-6",children:[e.jsx(n,{className:"h-4 w-4"}),e.jsx($,{children:"Upload clear, high-quality images or PDFs. All required documents must be verified before your venues can appear in the marketplace. File types: PDF, JPG, PNG. Max size: 25MB per file."})]}),e.jsx("div",{className:"space-y-6",children:N.map(t=>{const a=U(t.type),r=D[t.type];return e.jsxs(G,{className:"border-none shadow-lg",children:[e.jsxs(L,{children:[e.jsxs(R,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:"w-5 h-5 text-blue-600"}),t.title,t.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),a.length>0&&e.jsxs(d,{className:"bg-gray-100 text-gray-800",children:[a.length,"/",t.maxFiles]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]}),e.jsxs(V,{children:[a.length>0&&e.jsx("div",{className:"space-y-3 mb-4",children:a.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(n,{className:"w-4 h-4 text-gray-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["Document #",s.id.slice(-6)]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Uploaded ",new Date(s.created_date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{className:C(s.verified_status),children:[s.verified_status==="verified"&&e.jsx(B,{className:"w-3 h-3 mr-1"}),s.verified_status==="rejected"&&e.jsx(M,{className:"w-3 h-3 mr-1"}),s.verified_status.charAt(0).toUpperCase()+s.verified_status.slice(1)]}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>q(s.id),className:"w-8 h-8 text-gray-400 hover:text-red-600",children:e.jsx(E,{className:"w-4 h-4"})})]})]},s.id))}),a.length<t.maxFiles&&e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx(n,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:a.length===0?`Upload ${t.title}`:"Add more files"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",multiple:t.maxFiles>1,onChange:s=>F(s,t.type),disabled:r}),e.jsxs(f,{variant:"outline",size:"sm",disabled:r,children:[r?e.jsx(h,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(I,{className:"w-4 h-4 mr-2"}),"Choose Files"]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"PDF, JPG, PNG up to 25MB"})]})]})]},t.type)})})]})})})}export{T as default};
