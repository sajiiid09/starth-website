import{r as n,U as N,ao as O,aw as p,j as e,y as w,B as l,a4 as C,a as c,at as R,O as x,I as g,b as I,as as q,A as V,av as T}from"./index-KrjukJeb.js";import{C as u,c as h,a as B,b as M}from"./card-tLMu1Ov7.js";import{A as X,a as Q}from"./alert-8h-S5cZe.js";import{s as S}from"./Shield.es-C51nR2_i.js";import{s as H}from"./Upload.es-Dw-8j3Wc.js";import{m as Y}from"./WarningCircle.es-6KbXsyM7.js";import{R as P}from"./RoleGuard-DRkcvV5M.js";import{V as A}from"./VenuePortalLayout-DFmbwPeC.js";import"./Envelope.es-BErI3QgS.js";function ie(){const[f,L]=n.useState([]),[d,F]=n.useState(null),[D,U]=n.useState(!0),[j,y]=n.useState(!1),[E,o]=n.useState(!1),[t,v]=n.useState({carrier:"",policy_number:"",coverage_types:["General Liability"],coverage_amounts_json:{general_liability_occurrence:1e6,general_liability_aggregate:2e6},start_date:"",end_date:""});n.useEffect(()=>{b()},[]);const b=async()=>{try{const a=await N.me(),s=await O.filter({owner_user_id:a.id,type:"venue_owner"});if(s.length>0){F(s[0]);const r=await p.filter({org_id:s[0].id});L(r)}}catch(a){console.error("Error fetching insurance data:",a)}U(!1)},m=(a,s)=>{v(r=>({...r,[a]:s}))},$=async(a,s)=>{const r=a.target.files[0];if(r){y(!0);try{const{file_url:i}=await V({file:r});await T.create({org_id:d.id,entity_type:"organization",entity_id:d.id,doc_type:"insurance_certificate",storage_url:i,uploaded_by:(await N.me()).id}),await p.update(s,{certificate_doc_id:i}),await b()}catch(i){console.error("Error uploading certificate:",i)}y(!1)}},k=async()=>{if(d)try{await p.create({...t,org_id:d.id}),o(!1),v({carrier:"",policy_number:"",coverage_types:["General Liability"],coverage_amounts_json:{general_liability_occurrence:1e6,general_liability_aggregate:2e6},start_date:"",end_date:""}),await b()}catch(a){console.error("Error creating policy:",a)}},G=a=>{const s={pending:"bg-yellow-100 text-yellow-800",verified:"bg-green-100 text-green-800",expired:"bg-red-100 text-red-800",rejected:"bg-red-100 text-red-800"};return s[a]||s.pending};return D?e.jsx(P,{requiredRole:"venue_owner",children:e.jsx(A,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(w,{className:"w-8 h-8 animate-spin text-gray-500"})})})}):e.jsx(P,{requiredRole:"venue_owner",children:e.jsx(A,{children:e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Insurance Policies"}),e.jsx("p",{className:"text-gray-600",children:"Manage your insurance coverage and certificates"})]}),e.jsxs(l,{onClick:()=>o(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Add Policy"]})]}),e.jsxs(X,{className:"mb-6",children:[e.jsx(S,{className:"h-4 w-4"}),e.jsx(Q,{children:"Required: General Liability insurance with minimum $1M per occurrence and $2M aggregate coverage. Upload a valid Certificate of Insurance (COI) for verification."})]}),e.jsx(u,{className:"border-2 border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50 mb-6 shadow-lg",children:e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("img",{src:"https://qtrypzzcjebvfcihiynt.supabase.co/storage/v1/object/public/base44-prod/public/68d4e38c341adad3b24950ed/1d251d1b8_Screenshot2025-12-09at101157.png",alt:"NEXT Insurance",className:"w-24 h-auto flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"NEXT Insurance"}),e.jsx(c,{className:"bg-blue-600 text-white",children:"Partner"})]}),e.jsx("p",{className:"text-gray-700 mb-4",children:"Get instant coverage for your venue with our trusted insurance partner. Quick quotes, affordable rates, and same-day certificates."}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsx(c,{variant:"secondary",children:"✓ General Liability"}),e.jsx(c,{variant:"secondary",children:"✓ Property Coverage"}),e.jsx(c,{variant:"secondary",children:"✓ Instant COI"}),e.jsx(c,{variant:"secondary",children:"✓ Starting at $500/year"})]}),e.jsxs(l,{onClick:()=>window.open("https://www.nextinsurance.com","_blank"),className:"bg-blue-600 hover:bg-blue-700",children:["Get a Quote from NEXT",e.jsx(R,{className:"w-4 h-4 ml-2"})]})]})]})})}),E&&e.jsxs(u,{className:"border-none shadow-lg mb-6",children:[e.jsx(B,{children:e.jsx(M,{children:"Add Insurance Policy"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"carrier",children:"Insurance Carrier *"}),e.jsx(g,{id:"carrier",value:t.carrier,onChange:a=>m("carrier",a.target.value),placeholder:"e.g. State Farm, Allstate"})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"policy_number",children:"Policy Number *"}),e.jsx(g,{id:"policy_number",value:t.policy_number,onChange:a=>m("policy_number",a.target.value),placeholder:"Policy number"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(x,{htmlFor:"start_date",children:"Start Date *"}),e.jsx(g,{id:"start_date",type:"date",value:t.start_date,onChange:a=>m("start_date",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(x,{htmlFor:"end_date",children:"End Date *"}),e.jsx(g,{id:"end_date",type:"date",value:t.end_date,onChange:a=>m("end_date",a.target.value)})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{onClick:k,disabled:!t.carrier||!t.policy_number,children:"Add Policy"}),e.jsx(l,{variant:"outline",onClick:()=>o(!1),children:"Cancel"})]})]})]}),e.jsx("div",{className:"space-y-4",children:f.map(a=>{var s,r,i,_;return e.jsx(u,{className:"border-none shadow-lg",children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:a.carrier}),e.jsxs("p",{className:"text-gray-600",children:["Policy: ",a.policy_number]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Valid: ",new Date(a.start_date).toLocaleDateString()," - ",new Date(a.end_date).toLocaleDateString()]})]}),e.jsxs(c,{className:G(a.status),children:[a.status==="verified"&&e.jsx(I,{className:"w-3 h-3 mr-1"}),a.status==="pending"&&e.jsx(Y,{className:"w-3 h-3 mr-1"}),a.status.charAt(0).toUpperCase()+a.status.slice(1)]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Coverage"}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:["General Liability: $",(r=(s=a.coverage_amounts_json)==null?void 0:s.general_liability_occurrence)==null?void 0:r.toLocaleString()," per occurrence"]}),e.jsxs("p",{children:["Aggregate: $",(_=(i=a.coverage_amounts_json)==null?void 0:i.general_liability_aggregate)==null?void 0:_.toLocaleString()]})]})]}),a.certificate_doc_id?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5 text-green-600"}),e.jsx("span",{className:"text-sm font-medium text-green-800",children:"Certificate Uploaded"})]}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:a.status==="pending"?"Under review by our team":"Verified and approved"})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center",children:[e.jsx(q,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Upload Certificate of Insurance (COI)"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",className:"hidden",accept:".pdf,.jpg,.jpeg,.png",onChange:z=>$(z,a.id),disabled:j}),e.jsxs(l,{variant:"outline",size:"sm",disabled:j,children:[j?e.jsx(w,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(H,{className:"w-4 h-4 mr-2"}),"Choose File"]})]})]})]})},a.id)})}),f.length===0&&e.jsx(u,{className:"border-none shadow-lg",children:e.jsxs(h,{className:"text-center py-12",children:[e.jsx(S,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-3",children:"No Insurance Policies"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Add your first insurance policy to get your venues approved for the marketplace"}),e.jsxs(l,{onClick:()=>o(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Add Your First Policy"]})]})})]})})})}export{ie as default};
