import{r as o,U as D,ao as M,V as f,j as e,y as P,L as u,e as g,B as h,a4 as w,I as F,d as b,n as z,a as B,b as N,aq as T,t as x,_ as O}from"./index-KrjukJeb.js";import{C as y,c as S}from"./card-tLMu1Ov7.js";import{S as G}from"./switch-HwOEIoQi.js";import{n as q}from"./Clock.es-CCh8QZyI.js";import{f as Q}from"./MagnifyingGlass.es-Dx2DBm8Z.js";import{m as V}from"./Pencil.es-DgXKeFuK.js";import{m as Y}from"./WarningCircle.es-6KbXsyM7.js";import{R as E}from"./RoleGuard-DRkcvV5M.js";import{V as v}from"./VenuePortalLayout-DFmbwPeC.js";import"./Envelope.es-BErI3QgS.js";import"./Shield.es-C51nR2_i.js";function le(){const[n,c]=o.useState([]),[H,$]=o.useState(null),[i,C]=o.useState(null),[L,I]=o.useState(!0),[d,_]=o.useState("");o.useEffect(()=>{p()},[]);const p=async()=>{try{const s=await D.me();C(s);const t=await M.filter({owner_user_id:s.id,type:"venue_owner"});if(t.length>0){$(t[0]);const r=await f.filter({org_id:t[0].id},"-updated_date");c(r)}}catch(s){console.error("Error fetching venues:",s)}I(!1)},A=async(s,t)=>{const r=t?"active":"hidden",l=[...n],a=n.map(m=>m.id===s.id?{...m,status:r}:m);c(a);try{await f.update(s.id,{status:r}),x.success(`Venue is now ${r==="active"?"live":"hidden"}.`)}catch(m){c(l),x.error("Failed to update status. Please try again."),console.error("Status update failed:",m)}},U=async s=>{console.log("=== STARTING VENUE SUBMISSION ==="),console.log("Venue to submit:",s.name,"ID:",s.id);try{await f.update(s.id,{status:"submitted"}),console.log("✓ Venue status updated to 'submitted'");const t=n.map(a=>a.id===s.id?{...a,status:"submitted"}:a);c(t),console.log("=== ATTEMPTING EMAIL SEND ==="),console.log("Recipient: info@renzairegroup.com"),console.log("Subject: Venue Submission for Review:",s.name),console.log("User info:",{name:i==null?void 0:i.full_name,email:i==null?void 0:i.email});let r=!1,l=null;try{console.log("Calling SendEmail integration...");const a=await O({to:"info@renzairegroup.com",from_name:"Strathwell Platform",subject:`Venue Submission for Review: ${s.name}`,body:`
            <div style="font-family: sans-serif; line-height: 1.6;">
              <h2>Venue Submitted for Review</h2>
              <p>A venue has been submitted for approval on the Strathwell marketplace.</p>
              <hr>
              <h3>Venue Details:</h3>
              <ul>
                <li><strong>Venue ID:</strong> ${s.id}</li>
                <li><strong>Name:</strong> ${s.name}</li>
                <li><strong>Location:</strong> ${s.city}, ${s.state}</li>
                <li><strong>Category:</strong> ${s.category}</li>
                <li><strong>Capacity:</strong> ${s.capacity_min}-${s.capacity_max} guests</li>
                <li><strong>Submitted By:</strong> ${(i==null?void 0:i.full_name)||"N/A"} (${(i==null?void 0:i.email)||"N/A"})</li>
              </ul>
              <p>Please review and approve this venue listing in your admin dashboard.</p>
              <br>
              <p>Best regards,<br>Strathwell Platform</p>
            </div>
          `});console.log("✓✓✓ EMAIL SENT SUCCESSFULLY! ✓✓✓"),console.log("Email result:",JSON.stringify(a,null,2)),r=!0}catch(a){l=a,console.error("✗✗✗ EMAIL SENDING FAILED! ✗✗✗"),console.error("Error type:",a.constructor.name),console.error("Error message:",a.message),console.error("Full error:",a),a.response&&console.error("Error response:",a.response),a.stack&&console.error("Stack trace:",a.stack)}r?x.success("Venue submitted for review! Email notification sent."):x.warning(`Venue submitted but email failed: ${(l==null?void 0:l.message)||"Unknown error"}. Please notify admin manually.`),await p(),console.log("=== SUBMISSION COMPLETE ===")}catch(t){console.error("✗ SUBMISSION FAILED:",t),x.error("Failed to submit venue for review. Please try again.");const r=n.map(l=>l.id===s.id?{...l,status:"draft"}:l);c(r)}},R=s=>{const t={draft:"bg-gray-100 text-gray-800",submitted:"bg-yellow-100 text-yellow-800",active:"bg-green-100 text-green-800",hidden:"bg-red-100 text-red-800"};return t[s]||t.draft},k=s=>{const t={draft:e.jsx(V,{className:"w-4 h-4"}),submitted:e.jsx(q,{className:"w-4 h-4"}),active:e.jsx(N,{className:"w-4 h-4"}),hidden:e.jsx(Y,{className:"w-4 h-4"})};return t[s]||t.draft},j=n.filter(s=>{var t,r;return((t=s.name)==null?void 0:t.toLowerCase().includes(d.toLowerCase()))||((r=s.city)==null?void 0:r.toLowerCase().includes(d.toLowerCase()))});return L?e.jsx(E,{requiredRole:"venue_owner",children:e.jsx(v,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-gray-500"})})})}):e.jsx(E,{requiredRole:"venue_owner",children:e.jsx(v,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"My Venues"}),e.jsx("p",{className:"text-gray-600",children:"Manage your venue listings and track their status"})]}),e.jsx(u,{to:g("AddVenue"),children:e.jsxs(h,{className:"bg-blue-600 hover:bg-blue-700 text-white mt-4 md:mt-0",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Add New Venue"]})})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(F,{placeholder:"Search venues...",value:d,onChange:s=>_(s.target.value),className:"pl-10"})]})}),j.length>0?e.jsx("div",{className:"grid gap-6",children:j.map(s=>e.jsx(y,{className:"border-none shadow-lg hover:shadow-xl transition-all",children:e.jsx(S,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsx("div",{className:"lg:w-48 h-32 bg-gray-200 rounded-lg overflow-hidden flex-shrink-0",children:e.jsx("img",{src:s.hero_photo_url||"https://images.unsplash.com/photo-1497366216548-37526070297c?w=400&h=300&fit=crop",alt:s.name,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:s.name}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(b,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.city,", ",s.state]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsxs("span",{children:[s.capacity_min,"-",s.capacity_max," guests"]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsxs(B,{className:`${R(s.status)} flex items-center gap-1`,children:[k(s.status),s.status.charAt(0).toUpperCase()+s.status.slice(1)]}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Updated ",new Date(s.updated_date).toLocaleDateString()]})]})]}),e.jsx("p",{className:"text-gray-600 mb-4 line-clamp-2",children:s.description||"No description provided"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:s.status==="active"||s.status==="submitted"?e.jsxs(e.Fragment,{children:[e.jsx(G,{id:`live-switch-${s.id}`,checked:s.status==="active",onCheckedChange:t=>A(s,t),disabled:s.status==="draft"||s.status==="submitted"}),e.jsx("label",{htmlFor:`live-switch-${s.id}`,className:"text-sm font-medium text-gray-700",children:s.status==="active"?"Live on Marketplace":s.status==="submitted"?"Pending Review":"Hidden from Marketplace"})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Draft - Not yet submitted for review"})}),e.jsxs("div",{className:"flex gap-2",children:[s.status==="draft"&&e.jsxs(h,{onClick:()=>U(s),className:"bg-green-600 hover:bg-green-700 text-white",size:"sm",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"Submit for Review"]}),e.jsx(u,{to:g(`VenueDetails?id=${s.id}`),children:e.jsxs(h,{variant:"outline",size:"sm",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"View"]})}),e.jsx(u,{to:g(`EditVenue?id=${s.id}`),children:e.jsxs(h,{size:"sm",className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(V,{className:"w-4 h-4 mr-1"}),"Edit"]})})]})]})]})]})})},s.id))}):e.jsx(y,{className:"border-none shadow-lg",children:e.jsxs(S,{className:"text-center py-12",children:[e.jsx(b,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-medium text-gray-900 mb-3",children:d?"No venues found":"No venues yet"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:d?"Try adjusting your search terms":"Get started by adding your first venue to the platform"}),e.jsx(u,{to:g("AddVenue"),children:e.jsxs(h,{className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Add Your First Venue"]})})]})})]})})})}export{le as default};
