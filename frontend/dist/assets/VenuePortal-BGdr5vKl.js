import{r as o,U as G,ao as W,V as J,ap as K,a9 as Q,j as e,y as X,B as m,e as h,a2 as N,a as y,aq as Z,L as P,R as ee}from"./index-KrjukJeb.js";import{R as T}from"./RoleGuard-DRkcvV5M.js";import{V as z}from"./VenuePortalLayout-DFmbwPeC.js";import{C as b,a as w,b as k,c as S}from"./card-tLMu1Ov7.js";import{s as j}from"./CalendarCheck.es-DZn8vBmZ.js";import{m as se}from"./CurrencyDollar.es-CPzZPXmX.js";import{c as $}from"./TrendUp.es-DxtztzU8.js";import"./Envelope.es-BErI3QgS.js";import"./Shield.es-C51nR2_i.js";function xe(){var B;const[E,_]=o.useState(!0),[r,M]=o.useState(null),[i,I]=o.useState({venues:0,activeVenues:0,bookings:0,revenue:0,messages:0,monthlyRevenue:0,pendingBookings:0}),[R,Y]=o.useState([]),[V,q]=o.useState([]);o.useEffect(()=>{A()},[]);const A=async()=>{try{const s=await G.me();M(s);const c=await W.filter({owner_user_id:s.id,type:"venue_owner"});if(c.length===0){_(!1);return}const v=c[0],l=await J.filter({org_id:v.id}),u=l.filter(a=>a.status==="active"),d=l.map(a=>a.id);let C=0,D=0,U=0,L=0,x=[];const p={};if(d.length>0){const a=await K.filter({venue_id:{$in:d}});a.forEach(t=>{const n=t.venue_id;p[n]=(p[n]||0)+1}),x=a.filter(t=>["confirmed","paid","completed"].includes(t.status)).sort((t,n)=>Number(new Date(n.created_date))-Number(new Date(t.created_date)));const f=new Date().getMonth(),O=new Date().getFullYear();C=x.length,D=x.reduce((t,n)=>t+(n.total_cents||0),0),U=x.filter(t=>{const n=new Date(t.created_date);return n.getMonth()===f&&n.getFullYear()===O}).reduce((t,n)=>t+(n.total_cents||0),0),L=a.filter(t=>t.status==="pending").length,Y(x.slice(0,5))}const F=l.map(a=>({...a,bookingCount:p[a.id]||0})).sort((a,f)=>f.bookingCount-a.bookingCount).slice(0,3);q(F);const H=await Q.filter({user_id:s.id});I({venues:l.length,activeVenues:u.length,bookings:C,revenue:D/100,monthlyRevenue:U/100,messages:H.length,pendingBookings:L})}catch(s){console.error("Error fetching dashboard data:",s)}_(!1)};if(E)return e.jsx(T,{requiredRole:"venue_owner",children:e.jsx(z,{children:e.jsx("div",{className:"flex items-center justify-center h-screen",children:e.jsx(X,{className:"w-8 h-8 animate-spin text-gray-500"})})})});const g=({title:s,value:c,icon:v,description:l,trend:u,color:d="blue"})=>e.jsxs(b,{className:"border-none shadow-lg hover:shadow-xl transition-shadow",children:[e.jsxs(w,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(k,{className:"text-sm font-medium text-gray-600",children:s}),e.jsx("div",{className:`p-2 rounded-lg bg-${d}-100`,children:ee.cloneElement(v,{className:`h-4 w-4 text-${d}-600`})})]}),e.jsxs(S,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900 mb-1",children:c}),e.jsxs("div",{className:"flex items-center justify-between",children:[s==="Total Bookings"?e.jsx(y,{variant:"outline",className:"border-yellow-300 bg-yellow-50 text-yellow-800 text-xs font-medium",children:l}):e.jsx("p",{className:"text-xs text-gray-500",children:l}),u&&e.jsxs("div",{className:"flex items-center text-green-600 text-xs",children:[e.jsx($,{className:"w-3 h-3 mr-1"}),u]})]})]})]});return e.jsx(T,{requiredRole:"venue_owner",children:e.jsx(z,{children:e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsx("div",{className:"text-center mb-8",children:e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Welcome back, ",((B=r==null?void 0:r.full_name)==null?void 0:B.split(" ")[0])||"Partner","!"]}),e.jsx("p",{className:"text-lg text-gray-600",children:"Here's how your venues are performing"})]}),(r==null?void 0:r.roles)&&r.roles.length>1&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Switch to:"}),e.jsxs("div",{className:"flex gap-2",children:[r.roles.includes("organizer")&&e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{localStorage.setItem("activeRole","organizer"),window.location.href=h("Dashboard")},children:"Organizer"}),r.roles.includes("service_provider")&&e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{localStorage.setItem("activeRole","service_provider"),window.location.href=h("ProviderPortal")},children:"Provider"})]})]})]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4 mb-8",children:[e.jsx(g,{title:"Total Venues",value:i.venues,icon:e.jsx(N,{}),description:`${i.activeVenues} active listings`,color:"blue"}),e.jsx(g,{title:"Total Bookings",value:i.bookings,icon:e.jsx(j,{}),description:`${i.pendingBookings} pending approval`,color:"green"}),e.jsx(g,{title:"Total Revenue",value:i.revenue.toLocaleString("en-US",{style:"currency",currency:"USD"}),icon:e.jsx(se,{}),description:"All-time earnings",color:"purple"}),e.jsx(g,{title:"This Month",value:i.monthlyRevenue.toLocaleString("en-US",{style:"currency",currency:"USD"}),icon:e.jsx($,{}),description:"Current month revenue",trend:"+12%",color:"orange"})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs(b,{className:"lg:col-span-2 border-none shadow-lg",children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"w-5 h-5 text-green-600"}),"Recent Bookings"]})}),e.jsx(S,{children:R.length>0?e.jsx("div",{className:"space-y-4",children:R.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx(j,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:["Booking #",s.id.slice(-6)]}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(s.created_date).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(y,{className:s.status==="completed"?"bg-green-100 text-green-800":s.status==="confirmed"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800",children:s.status}),e.jsx("span",{className:"font-semibold text-gray-900",children:(s.total_cents/100).toLocaleString("en-US",{style:"currency",currency:"USD"})}),e.jsx(m,{variant:"ghost",size:"icon",children:e.jsx(Z,{className:"w-4 h-4"})})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(j,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:"No bookings yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Your bookings will appear here once you start receiving them"})]})})]}),e.jsxs(b,{className:"border-none shadow-lg",children:[e.jsx(w,{children:e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5 text-blue-600"}),"Top Venues"]})}),e.jsx(S,{children:V.length>0?e.jsx("div",{className:"space-y-4",children:V.map((s,c)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-sm font-semibold text-blue-600",children:c+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.city})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-sm font-semibold text-gray-900",children:[s.bookingCount," bookings"]}),e.jsx(y,{variant:"outline",className:"text-xs",children:s.status})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(N,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No venue data yet"})]})})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("div",{className:"inline-flex gap-4",children:[e.jsx(P,{to:h("VenueListings"),children:e.jsx(m,{className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Manage Venues"})}),e.jsx(P,{to:h("VenueAvailability"),children:e.jsx(m,{variant:"outline",children:"Update Pricing"})})]})})]})})})})}export{xe as default};
